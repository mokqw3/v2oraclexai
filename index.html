<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE X AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style>
        /* Base styles for both login and app */
        body {
            font-family: 'El Messiri', sans-serif;
            /* Dark, sleek gradient background */
            background: linear-gradient(135deg, #1A202C, #2D3748, #1A202C);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            margin: 0;
            padding: 0;
            color: #E2E8F0; /* Light text for dark background */
        }
        :root {
            --dark-bg-primary: #1A202C;
            --dark-bg-secondary: #2D3748;
            --dark-bg-card: rgba(30, 41, 59, 0.95); /* Dark translucent for cards */
            --dark-border: rgba(255, 255, 255, 0.1);
            --dark-text-light: #E2E8F0;
            --dark-text-medium: #CBD5E0;
            --dark-text-dark: #A0AEC0; /* For less important text */
            --dark-shadow: rgba(0, 0, 0, 0.4); /* Deeper shadow for dark theme */
            
            /* Accent colors - adjusted for dark theme vibrancy */
            --purple-accent: #9747FF; /* Main vibrant purple */
            --purple-light-accent: #C7AEFF; /* Lighter purple */
            --green-accent: #10B981; /* Teal green */
            --red-accent: #EF4444; /* Bright red */
            --orange-accent: #F97316; /* Orange */
            --blue-accent: #3B82F6; /* Blue */
            --yellow-accent: #F59E0B; /* Yellow */
            --pink-accent: #EC4899; /* Pink */
            --teal-accent: #14B8A6; /* Teal */
            --violet-accent: #8A2BE2; /* Violet */

            /* Login specific colors, harmonized with app colors */
            --login-primary: var(--purple-accent);
            --login-primary-light: rgba(151, 71, 255, 0.2); /* Lighter translucent for bg */
            --login-primary-dark: #7B3EED;
            --login-secondary: var(--violet-accent);
            --login-white: #FFFFFF;
            --login-light-bg: #F8FAFA; /* Not used much in dark theme */
            --login-text-dark: #E2E8F0; /* Light text for dark login inputs */
            --login-text-light: #A0AEC0; /* Medium gray for hints */
        }
        * {
            color: var(--dark-text-light); /* Default text color for everything */
        }
        
        /* Overrides for specific elements that need dark text on light backgrounds (if any remain) */
        .input-field {
            color: var(--dark-text-light) !important; /* Ensure input text is light */
        }
        .submit-btn, .copy-btn {
             color: var(--login-white) !important; /* Ensure button text is white */
        }


        /* Login Screen Specific Styles */
        #loginScreen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            width: 100%; /* Ensure it takes full width */
            transition: opacity 0.5s ease;
        }
        .login-container {
            background: var(--dark-bg-card); /* Dark translucent background */
            backdrop-filter: blur(8px);
            border-radius: 16px;
            box-shadow: 0 10px 20px var(--dark-shadow); /* Darker shadow */
            /* Reduced padding */
            padding: 1.75rem; /* Changed from 2rem */
            width: 100%;
            max-width: 400px;
            position: relative;
            z-index: 2;
            border: 1px solid var(--dark-border); /* Subtle border */
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }
        .login-container.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .login-container:hover {
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5); /* Even darker shadow on hover */
            transform: translateY(-3px);
        }
        .logo-container {
            text-align: center;
            /* Reduced margin-bottom */
            margin-bottom: 1rem; /* Changed from 1.5rem */
            transform: scale(0.9);
            opacity: 0;
        }
        .logo-img {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--purple-accent); /* Vibrant border */
            box-shadow: 0 8px 15px rgba(151, 71, 255, 0.2); /* Shadow with accent color */
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        .logo-img:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(151, 71, 255, 0.3);
        }
        .title {
            color: var(--purple-light-accent); /* Lighter accent color for title */
            font-weight: 700;
            font-size: 1.7rem;
            margin-top: 0.8rem;
            background: linear-gradient(to right, var(--purple-accent), var(--violet-accent)); /* Gradient text */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .last-key {
            color: var(--dark-text-dark); /* Darker gray for subtle text */
            font-size: 0.9rem;
            margin-top: 0.5rem;
            font-weight: 500;
        }
        .error-message {
            color: var(--red-accent);
            text-align: center;
            margin-top: 0.8rem;
            font-weight: 500;
            font-size: 0.9rem;
            transform: scale(0.95);
            opacity: 0;
            padding: 8px;
            border-radius: 6px;
            background-color: rgba(239, 68, 68, 0.1); /* Subtle red background */
            border-left: 3px solid var(--red-accent);
        }
        .success-message {
            color: var(--green-accent);
            text-align: center;
            margin-top: 0.8rem;
            font-weight: 500;
            font-size: 0.9rem;
            transform: scale(0.95);
            opacity: 0;
            padding: 8px;
            border-radius: 6px;
            background-color: rgba(16, 185, 129, 0.1); /* Subtle green background */
            border-left: 3px solid var(--green-accent);
        }
        .input-group {
            position: relative;
            /* Reduced margin-bottom */
            margin-bottom: 0.8rem; /* Changed from 1.2rem */
            transform: translateX(-20px);
            opacity: 0;
        }
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--dark-text-dark); /* Subtle icon color */
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .input-field {
            width: 100%;
            padding: 12px 18px 12px 45px;
            border-radius: 10px;
            border: 1px solid var(--dark-border); /* Subtle border */
            background-color: var(--dark-bg-secondary); /* Darker input field background */
            font-size: 0.95rem;
            color: var(--dark-text-light); /* Light text for input */
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: var(--purple-accent); /* Accent color on focus */
            box-shadow: 0 0 0 3px rgba(151, 71, 255, 0.15); /* Accent shadow */
        }
        .input-field:focus + .input-icon {
            transform: translateY(-50%) scale(1.1);
            color: var(--purple-accent); /* Accent color for icon on focus */
        }
        .submit-btn {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            background: linear-gradient(to right, var(--purple-accent), var(--violet-accent)); /* Gradient button */
            color: var(--login-white); /* White text */
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            transform: translateY(20px);
            opacity: 0;
            box-shadow: 0 5px 15px rgba(151, 71, 255, 0.25); /* Accent shadow */
            position: relative;
            overflow: hidden;
        }
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.1), transparent); /* Light shimmer effect */
            transition: all 0.5s ease;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(151, 71, 255, 0.35); /* Deeper accent shadow on hover */
        }
        .submit-btn:hover::before {
            left: 100%;
        }
        .copy-btn {
            width: 100%; /* Ensure full width for consistent spacing */
            padding: 10px 18px;
            border-radius: 8px;
            background: var(--dark-bg-secondary); /* Dark background for copy button */
            border: 1px solid var(--dark-border);
            color: var(--dark-text-light); /* Light text */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            /* Reduced margin-top */
            margin-top: 0.6rem; /* Changed from 0.8rem */
            transform: translateY(20px);
            opacity: 0;
            box-shadow: 0 3px 10px var(--dark-shadow); /* Dark shadow */
            position: relative;
            overflow: hidden;
            display: flex; /* Use flex to center content if needed */
            justify-content: center;
            align-items: center;
        }
        .copy-btn:hover {
            background: var(--dark-bg-primary); /* Even darker background on hover */
            color: var(--purple-light-accent); /* Accent color on hover */
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        .copy-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1); /* Subtle white overlay for copy animation */
            left: -100%;
            top: 0;
            transition: all 0.3s ease;
        }
        .copy-btn.copied .copy-animation {
            left: 0;
        }
        .loading-message {
            color: var(--purple-accent);
            text-align: center;
            /* Reduced margin-top */
            margin-top: 0.6rem; /* Changed from 0.8rem */
            font-weight: 500;
            display: none;
        }
        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            /* Reduced margin-top */
            margin-top: 1rem; /* Changed from 1.5rem */
            opacity: 0;
            transform: translateY(20px);
        }
        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--login-white);
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: linear-gradient(to bottom right, var(--purple-accent), var(--violet-accent)); /* Gradient social link */
            box-shadow: 0 3px 10px rgba(151, 71, 255, 0.2);
        }
        .social-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(151, 71, 255, 0.3);
        }
        .floating-element {
            position: absolute;
            background-color: var(--login-primary-light); /* Lighter translucent accent */
            border-radius: 50%;
            z-index: 1;
            filter: blur(1px);
            opacity: 0.2; /* More subtle floating elements */
        }
        .star {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.7); /* Lighter stars */
            border-radius: 50%;
            z-index: 1;
            animation: twinkle var(--duration) infinite ease-in-out;
            opacity: 0;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.9); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: var(--purple-accent); /* Accent color for confetti */
            opacity: 0;
            z-index: 10;
        }
        @media (max-width: 480px) {
            .login-container { padding: 1.5rem; }
            .logo-img { width: 70px; height: 70px; }
            .title { font-size: 1.4rem; }
            .last-key, .error-message, .success-message { font-size: 0.8rem; }
            .input-field { padding: 10px 15px 10px 40px; font-size: 0.9rem; }
            .submit-btn, .copy-btn { padding: 12px; font-size: 0.9rem; }
        }

        /* Main App Specific Styles (inherited and overridden) */
        #mainAppScreen {
            display: none; /* Hidden by default, shown after login */
            width: 100%;
            min-height: 100vh;
            flex-direction: column; /* Ensure it behaves like the original app body */
        }

        /* --- From oracle-x-ai-app.html --- */
        .popup, .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark-bg-card); /* Dark translucent background */
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 6px 16px var(--dark-shadow);
            backdrop-filter: blur(8px);
            z-index: 1000;
            width: 90%;
            max-width: 400px;
            border: 2px solid var(--dark-border); /* Subtle border */
        }
        .popup.active, .modal.active { display: block; }
        .win-popup, .loss-popup, .pattern-warning, .history-deleted-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark-bg-card); /* Dark translucent background */
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 6px 16px var(--dark-shadow);
            backdrop-filter: blur(8px);
            z-index: 1000;
            width: 90%;
            max-width: 400px;
            border: 2px solid var(--green-accent); /* Accent border for win */
            text-align: center;
        }
        .loss-popup, .pattern-warning { border: 2px solid var(--red-accent); } /* Accent border for loss/warning */
        .history-deleted-popup { border: 2px solid var(--purple-accent); } /* Accent border for history */
        .win-popup.active, .loss-popup.active, .pattern-warning.active, .history-deleted-popup.active { display: block; }
        .confetti-icon { font-size: 2rem; margin-bottom: 1rem; color: var(--purple-accent); } /* Accent color for icon */
        .play-resume {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark-bg-card); /* Dark translucent background */
            padding: 1.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 6px 16px var(--dark-shadow);
            backdrop-filter: blur(8px);
            z-index: 1000;
            width: 90%;
            max-width: 400px;
            border: 2px solid var(--green-accent); /* Accent border */
            text-align: center;
        }
        .play-resume.active { display: block; }
        .play-icon { font-size: 2rem; margin-bottom: 1rem; color: var(--green-accent); }
        .card {
            transition: all 0.3s ease;
            background: var(--dark-bg-card); /* Dark translucent background */
            border-radius: 1.5rem;
            box-shadow: 0 6px 12px var(--dark-shadow);
            backdrop-filter: blur(8px);
            position: relative;
            margin: 0.75rem;
            overflow: hidden;
            border: 1px solid var(--dark-border); /* Subtle border */
        }
        .card:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5); /* Deeper shadow on hover */
        }
        .gradient-bg { background: linear-gradient(135deg, var(--green-accent), var(--teal-accent)); } /* Accent gradient */
        svg {
            width: 100%;
            height: auto;
            margin: 0 auto;
            display: block;
        }
        svg text {
            text-anchor: middle;
            dominant-baseline: middle;
            text-transform: uppercase;
            animation: stroke 5s infinite alternate;
            stroke-width: 1.2;
            stroke: var(--purple-light-accent); /* Lighter accent for stroke */
            font-size: 10vw; /* Adjusted for responsiveness */
            fill: rgba(255, 255, 255, 0);
        }
        @media (min-width: 768px) {
            svg text { font-size: 130px; } /* Larger font for desktop */
        }
        @keyframes stroke {
            0% { fill: rgba(255, 255, 255, 0); stroke: var(--purple-accent); stroke-dashoffset: 25%; stroke-dasharray: 0 50%; stroke-width: 1.2; }
            70% { fill: rgba(255, 255, 255, 0); stroke: var(--blue-accent); }
            80% { fill: rgba(255, 255, 255, 0); stroke: var(--teal-accent); stroke-width: 2.5; }
            100% { fill: var(--dark-text-light); stroke: rgba(0, 0, 0, 0); stroke-dashoffset: -25%; stroke-dasharray: 50% 0; stroke-width: 0; }
        }
        .history-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: none;
            overflow: visible;
            position: relative;
        }
        .history-item {
            transition: all 0.3s ease;
            width: 100%;
            max-width: 100%;
            margin: 0;
            border-radius: 1.2rem;
            background: var(--dark-bg-secondary); /* Slightly lighter dark background for history items */
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 14px var(--dark-shadow);
            position: relative;
            overflow: hidden;
            padding: 1.2rem;
            border-left: 4px solid transparent; 
        }
        .history-item.win { border-left-color: var(--green-accent); background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), var(--dark-bg-secondary)); }
        .history-item.loss { border-left-color: var(--red-accent); background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), var(--dark-bg-secondary)); }
        .history-item.pending { border-left-color: var(--yellow-accent); background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), var(--dark-bg-secondary)); }
        .history-item.skipped { border-left-color: var(--dark-text-dark); background: linear-gradient(135deg, rgba(160, 174, 192, 0.15), var(--dark-bg-secondary)); }
        .history-item:hover { transform: scale(1.02); box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5); }
        .history-item.fade-out { animation: fadeOut 0.5s ease forwards; }
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.95); height: 0; padding: 0; margin: 0; }
        }
        .history-item .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.05); /* Very subtle white watermark */
            pointer-events: none;
            z-index: 0;
            text-transform: uppercase;
            font-weight: bold;
        }
        .small-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--teal-accent);
            border-radius: 50%;
            animation: float 4s infinite;
            z-index: 1;
        }
        @keyframes float {
            0% { transform: translate(0, 0); opacity: 0.9; }
            50% { transform: translate(12px, -12px); opacity: 0.5; }
            100% { transform: translate(0, 0); opacity: 0.9; }
        }
        .delete-btn { color: var(--dark-text-medium); } /* Default button color */
        .delete-btn:hover { color: var(--purple-accent); transform: scale(1.3); }
        .win-badge { background: rgba(16, 185, 129, 0.2); color: var(--green-accent); }
        .loss-badge { background: rgba(239, 68, 68, 0.2); color: var(--red-accent); }
        .pending-badge { background: rgba(245, 158, 11, 0.2); color: var(--yellow-accent); }
        .skipped-badge { background: rgba(160, 174, 192, 0.2); color: var(--dark-text-dark); }
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
            overflow: hidden;
        }
        .status-icon::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            opacity: 0.2;
            background: radial-gradient(circle, currentColor 0%, transparent 70%);
        }
        .win-icon { color: var(--green-accent); animation: pulseWin 1.5s infinite; }
        .loss-icon { color: var(--red-accent); animation: pulseLoss 1s infinite; }
        .pending-icon { color: var(--yellow-accent); animation: rotate 2s infinite linear; }
        .skipped-icon { color: var(--dark-text-dark); animation: pulseSkip 1.5s infinite; }
        @keyframes pulseWin {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        @keyframes pulseLoss {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes pulseSkip {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .dashboard-card {
            background: var(--dark-bg-card); /* Dark translucent background */
            border-radius: 1.5rem;
            padding: 1.2rem;
            box-shadow: 0 4px 10px var(--dark-shadow);
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
            border: 1px solid var(--dark-border); /* Subtle border */
        }
        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.5); /* Deeper shadow on hover */
        }
        .confidence-meter {
            height: 10px;
            background: var(--dark-border); /* Dark background for meter track */
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            display: none; /* Always hidden */
        }
        .confidence-fill {
            height: 100%;
            background: var(--green-accent); /* Green for confidence fill */
            transition: width 0.5s ease;
        }
        .confidence-fill.red { background: var(--red-accent); }
        .confidence-fill.violet { background: var(--violet-accent); }
        .navigation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 350px;
            height: 70px;
            background: var(--dark-bg-card);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 1.5rem;
            box-shadow: 0 6px 12px var(--dark-shadow);
            z-index: 1000;
            border: 1px solid var(--dark-border);
        }
        .navigation ul { display: flex; width: 300px; }
        .navigation ul li {
            position: relative;
            list-style: none;
            width: 75px;
            height: 70px;
            z-index: 1;
        }
        .navigation ul li a {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
            text-align: center;
            font-weight: 500;
            color: var(--dark-text-medium);
        }
        .navigation ul li a .icon {
            position: relative;
            display: block;
            line-height: 75px;
            font-size: 1.5em;
            text-align: center;
            transition: 0.5s;
            color: var(--dark-text-medium);
        }
        .navigation ul li.active a .icon { transform: translateY(-32px); color: var(--purple-accent); }
        .navigation ul li a .text {
            position: absolute;
            font-weight: 400;
            font-size: 0.75em;
            letter-spacing: 0.05em;
            transition: 0.5s;
            opacity: 0;
            transform: translateY(20px);
            color: var(--dark-text-medium);
        }
        .navigation ul li.active a .text { opacity: 1; transform: translateY(10px); color: var(--purple-accent); }
        .indicator {
            position: absolute;
            top: -50%;
            width: 70px;
            height: 70px;
            background: var(--purple-accent);
            border-radius: 50%;
            border: 6px solid var(--dark-bg-secondary);
            transition: 0.5s;
        }
        .indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -22px;
            width: 20px;
            height: 20px;
            background: transparent;
            border-top-right-radius: 20px;
            box-shadow: 1px -10px 0 0 var(--dark-bg-secondary);
        }
        .indicator::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -22px;
            width: 20px;
            height: 20px;
            background: transparent;
            border-top-left-radius: 20px;
            box-shadow: -1px -10px 0 0 var(--dark-bg-secondary);
        }
        .navigation ul li:nth-child(1).active ~ .indicator { transform: translateX(calc(75px * 0)); }
        .navigation ul li:nth-child(2).active ~ .indicator { transform: translateX(calc(75px * 1)); }
        .navigation ul li:nth-child(3).active ~ .indicator { transform: translateX(calc(75px * 2)); }
        .navigation ul li:nth-child(4).active ~ .indicator { transform: translateX(calc(75px * 3)); }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .mode-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .mode-toggle input { opacity: 0; width: 0; height: 0; }
        .mode-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-text-dark);
            transition: .4s;
            border-radius: 34px;
        }
        .mode-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: #ffffff;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .mode-slider { background-color: var(--green-accent); }
        input:checked + .mode-slider:before { transform: translateX(30px); }
        .mode-icons {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 8px;
            pointer-events: none;
        }
        .mode-icons i, .mode-icons span {
            font-size: 14px;
            color: var(--dark-text-light);
        }
        .contact-links {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        .contact-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            font-size: 12px;
            color: var(--dark-text-light);
        }
        .contact-link i {
            font-size: 20px;
            margin-bottom: 5px;
            color: var(--purple-accent);
        }
        .period-id {
            font-family: monospace;
            letter-spacing: 2px;
            font-size: 1.2rem;
            background: var(--dark-bg-primary) !important;
            border: 1px solid var(--dark-border);
        }
        #currentPeriod, #currentResult { border: none !important; }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            display: none;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        button, .btn {
            border-radius: 1rem;
            background: linear-gradient(135deg, var(--green-accent), var(--teal-accent));
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
            color: #ffffff;
        }
        button:hover, .btn:hover {
            background: linear-gradient(135deg, var(--teal-accent), var(--green-accent));
            transform: scale(1.05);
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-bg-card);
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px var(--dark-shadow);
            z-index: 2000;
            color: var(--dark-text-light);
            border: 1px solid var(--dark-border);
        }

        /* Advanced Status Bar Styles (Hidden from UI) */
        .advanced-status-bar {
            display: none; /* Keep hidden as per previous instruction */
        }

        /* New styles for Red/Green/Violet badges and text */
        .red-badge { background: rgba(239, 68, 68, 0.25); color: var(--red-accent); }
        .green-badge { background: rgba(16, 185, 129, 0.25); color: var(--green-accent); }
        .violet-badge { background: rgba(138, 43, 226, 0.25); color: var(--violet-accent); }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .card { padding: 0.75rem; margin: 0.5rem; border-radius: 1rem; }
            .grid-cols-2 { grid-template-columns: 1fr; }
            .md\\:grid-cols-3 { grid-template-columns: 1fr 1fr; }
            .text-3xl { font-size: 1.5rem; }
            .text-2xl { font-size: 1.25rem; }
            .text-xl { font-size: 1rem; }
            .text-lg { font-size: 0.875rem; }
            .text-sm { font-size: 0.75rem; }
            .p-6 { padding: 0.75rem; }
            .p-5 { padding: 0.5rem; }
            .w-12 { width: 2.5rem; height: 2.5rem; }
            .history-item { padding: 1rem; border-radius: 1rem; }
            .history-item .watermark { font-size: 1rem; }
            .rounded-xl { border-radius: 0.75rem; }
            .gap-4 { gap: 0.75rem; }
            .mb-4 { margin-bottom: 0.75rem; }
            .mb-2 { margin-bottom: 0.5rem; }
            .mb-1 { margin-bottom: 0.3rem; }
            .px-4 { padding-left: 0.75rem; padding-right: 0.75rem; }
            .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
            .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
            .space-x-2 > * + * { margin-left: 0.5rem; }
            .space-x-1 > * + * { margin-left: 0.3rem; }
            .navigation { width: 300px; border-radius: 1rem; }
            .navigation ul { width: 250px; }
            .navigation ul li { width: 62.5px; }
            .indicator { width: 60px; height: 60px; }
            .navigation ul li:nth-child(1).active ~ .indicator { transform: translateX(calc(62.5px * 0)); }
            .navigation ul li:nth-child(2).active ~ .indicator { transform: translateX(calc(62.5px * 1)); }
            .navigation ul li:nth-child(3).active ~ .indicator { transform: translateX(calc(62.5px * 2)); }
            .navigation ul li:nth-child(4).active ~ .indicator { transform: translateX(calc(62.5px * 3)); }
            .popup, .modal, .win-popup, .loss-popup, .play-resume, .history-deleted-popup { max-width: 320px; padding: 1rem; border-radius: 1rem; }
            .advanced-status-bar {
                font-size: 0.7rem;
                padding: 0.5rem 0.75rem;
            }
            .advanced-status-bar span {
                margin-right: 0.5rem;
                padding: 0.15rem 0.3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen w-full flex items-center justify-center">
        <div class="floating-element" style="width: 150px; height: 150px; top: 15%; left: 10%; background: radial-gradient(circle, var(--login-primary-light), transparent 70%);"></div>
        <div class="floating-element" style="width: 100px; height: 100px; bottom: 20%; right: 12%; background: radial-gradient(circle, var(--login-primary-light), transparent 70%);"></div>
        <div class="floating-element" style="width: 80px; height: 80px; top: 35%; right: 18%; background: radial-gradient(circle, var(--login-primary-light), transparent 70%);"></div>
        <div class="floating-element" style="width: 120px; height: 120px; bottom: 30%; left: 15%; background: radial-gradient(circle, var(--login-primary-light), transparent 70%);"></div>

        <div id="stars-container-login"></div>
        <div id="confetti-container-login"></div>

        <div class="login-container" id="loginContainer">
            <div class="logo-container">
                <!-- Custom Logo URL -->
                <img src="https://placehold.co/90x90/9747FF/FFFFFF?text=ORACLE+X+AI" alt="ORACLE X AI Logo" class="logo-img">
                <h1 class="title">ORACLE X AI</h1>
                <div class="last-key" id="lastKey"></div>
                <div class="error-message" id="error"></div>
                <div class="success-message" id="success"></div>
            </div>

            <div class="input-group" id="inputGroup">
                <i class="fas fa-key input-icon"></i>
                <input type="text" id="accessKey" placeholder="Enter License Key" required class="input-field">
            </div>

            <div class="loading-message" id="loading">Loading...</div>

            <button class="submit-btn" id="submitBtn" onclick="handleLogin()">
                <i class="fas fa-sign-in-alt mr-2"></i> Login
            </button>

            <div class="text-center mt-4">
                <button class="copy-btn" id="copyDeviceIdButton" onclick="copyDeviceId()">
                    <span class="copy-animation"></span>
                    <i class="fas fa-copy mr-2"></i> 
                    <span id="copyText">Copy Device ID</span>
                </button>
            </div>

            <div class="text-center mt-4">
                <button class="copy-btn" onclick="getKey()">
                    <i class="fas fa-key mr-2"></i> Get Access Key
                </button>
            </div>

            <div class="social-links" id="socialLinks">
                <a href="https://t.me/ORACLEXAIADMIN" target="_blank" class="social-link" title="Telegram">
                    <i class="fab fa-telegram"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Predictor Application Screen -->
    <div id="mainAppScreen" class="w-full relative pb-20" style="display: none;">
        <header class="text-center mt-0 mb-2 animate__animated animate__fadeInDown">
            <svg viewBox="0 0 800 120">
                <text x="50%" y="50%">ORACLE X AI</text>
            </svg>
            <div id="advancedStatusBar" class="advanced-status-bar animate__animated animate__fadeIn">
                <!-- Content will be dynamically updated by JavaScript -->
            </div>
        </header>

        <div class="max-w-full mx-auto p-2 w-full">
            <div class="max-w-4xl mx-auto p-2 w-full">
                <!-- Home Section -->
                <div id="homeSection" class="content-section active">
                    <div class="card mb-4 overflow-hidden gradient-bg animate__animated animate__zoomIn relative">
                        <div class="bg-white bg-opacity-95 p-6 rounded-lg pulse-animation" style="background: var(--dark-bg-card) !important; color: var(--dark-text-light) !important;">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="relative">
                                    <div class="pl-2">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <i class="fas fa-calendar-alt text-2xl animate__animated animate__bounce" style="color: var(--purple-accent);"></i>
                                            <h2 class="text-2xl font-bold" style="color: var(--dark-text-light);">Period</h2>
                                        </div>
                                        <p id="currentPeriod" class="text-2xl font-semibold p-3 rounded-lg shadow-inner period-id">-</p>
                                    </div>
                                </div>
                                <div class="relative text-right">
                                    <div class="pr-2">
                                        <div class="flex items-center justify-end space-x-2 mb-2">
                                            <h2 id="predictionTitle" class="text-2xl font-bold" style="color: var(--dark-text-light);">Prediction</h2>
                                            <i class="fas fa-poll text-2xl animate__animated animate__bounce" style="color: var(--purple-accent);"></i>
                                        </div>
                                        <p id="currentPredictionResult" class="text-2xl font-semibold p-3 rounded-lg shadow-inner period-id">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="confidence-meter">
                                <div id="confidenceFill" class="confidence-fill" style="width: 0%"></div>
                            </div>
                            <p id="confidenceText" class="text-sm mt-1" style="color: var(--dark-text-medium);"></p>
                        </div>
                        <div class="small-dot" style="top: 15%; left: 15%; animation-delay: 0.2s;"></div>
                        <div class="small-dot" style="top: 85%; left: 85%; animation-delay: 0.8s;"></div>
                        <div class="small-dot" style="top: 50%; left: 25%; animation-delay: 1.2s;"></div>
                        <div class="small-dot" style="top: 20%; left: 80%; animation-delay: 1.6s;"></div>
                    </div>

                    <div class="card mb-4 p-6 animate__animated animate__fadeInUp relative">
                        <h2 class="text-3xl font-bold text-center mb-4 relative" style="color: var(--dark-text-light);">
                            <span class="relative z-10 pulse-animation">Analysis Dashboard</span>
                            <span class="absolute top-1/2 left-0 w-full h-2 rounded-full" style="background: var(--dark-bg-primary);"></span>
                        </h2>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-star text-lg" style="color: var(--purple-accent);"></i>
                                        <div>
                                            <p class="text-sm" style="color: var(--dark-text-medium);">Most Frequent</p>
                                            <p id="mostFrequent" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.1s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-arrow-down text-lg" style="color: var(--purple-accent);"></i>
                                        <div>
                                            <p class="text-sm" style="color: var(--dark-text-medium);">Least Frequent</p>
                                            <p id="leastFrequent" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.2s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-percentage text-lg" style="color: var(--purple-accent);"></i>
                                        <div>
                                            <p class="text-sm" style="color: var(--dark-text-medium);">Win Rate</p>
                                            <p id="homeWinRate" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.3s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-trophy text-lg" style="color: var(--green-accent);"></i>
                                        <div>
                                            <p class="text-sm" style="color: var(--dark-text-medium);">Wins</p>
                                            <p id="totalWinBets" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card animate__animated animate__fadeIn" style="animation-delay: 0.4s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-skull text-lg" style="color: var(--red-accent);"></i>
                                        <div>
                                            <p class="text-sm" style="color: var(--dark-text-medium);">Losses</p>
                                            <p id="totalLossBets" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="dashboard-card flex items-center justify-between animate__animated animate__fadeIn" style="animation-delay: 0.5s;">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-server text-lg" style="color: var(--purple-accent);"></i>
                                        <div>
                                            <p class="text-sm" style="color: var(--dark-text-medium);">Server Status</p>
                                            <p id="serverStatus" class="font-semibold" style="color: var(--green-accent);">Connected</p>
                                        </div>
                                    </div>
                                    <div id="serverStatusIndicator" class="w-3 h-3 rounded-full animate-ping" style="background-color: var(--green-accent);"></div>
                                </div>
                            </div>
                            <div class="small-dot" style="top: 10%; left: 10%; animation-delay: 0.3s;"></div>
                            <div class="small-dot" style="top: 90%; left: 90%; animation-delay: 0.9s;"></div>
                            <div class="small-dot" style="top: 30%; left: 70%; animation-delay: 1.5s;"></div>
                        </div>
                    </div>

                <!-- History Section -->
                <div id="historySection" class="content-section">
                    <div class="card p-6 animate__animated animate__fadeInUp relative">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-3xl font-bold text-center relative" style="color: var(--dark-text-light);">
                                <span class="relative z-10 pulse-animation">History</span>
                                <span class="absolute top-1/2 left-0 w-full h-2 rounded-full" style="background: var(--dark-bg-primary);"></span>
                            </h2>
                            <button id="deleteAllHistoryBtn" class="px-4 py-2 rounded-lg hover:opacity-80 transition flex items-center" style="background: var(--red-accent); color: white;">
                                <i class="fas fa-trash-alt mr-2"></i><span>Delete</span>
                            </button>
                        </div>
                        <div id="history" class="history-container"></div>
                        <div class="small-dot" style="top: 20%; left: 30%; animation-delay: 0.4s;"></div>
                        <div class="small-dot" style="top: 80%; left: 70%; animation-delay: 0.9s;"></div>
                        <div class="small-dot" style="top: 40%; left: 50%; animation-delay: 1.3s;"></div>
                    </div>
                </div>

                <!-- Stats Section -->
                <div id="statsSection" class="content-section">
                    <div class="card p-6 animate__animated animate__fadeInUp relative">
                        <h2 class="text-3xl font-bold text-center mb-4 relative" style="color: var(--dark-text-light);">
                            <span class="relative z-10 pulse-animation">Statistics</span>
                            <span class="absolute top-1/2 left-0 w-full h-2 rounded-full" style="background: var(--dark-bg-primary);"></span>
                        </h2>
                        <div class="stats-grid">
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-trophy text-lg" style="color: var(--green-accent);"></i>
                                    <div>
                                        <p class="text-sm" style="color: var(--dark-text-medium);">Total Wins</p>
                                        <p id="statsTotalWins" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-skull text-lg" style="color: var(--red-accent);"></i>
                                    <div>
                                        <p class="text-sm" style="color: var(--dark-text-medium);">Total Losses</p>
                                        <p id="statsTotalLosses" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-percentage text-lg" style="color: var(--yellow-accent);"></i>
                                    <div>
                                        <p class="text-sm" style="color: var(--dark-text-medium);">Win Rate</p>
                                        <p id="statsWinRate" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-fire text-lg" style="color: var(--orange-accent);"></i>
                                    <div>
                                        <p class="text-sm" style="color: var(--dark-text-medium);">Current Streak</p>
                                        <p id="currentStreak" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-history text-lg" style="color: var(--blue-accent);"></i>
                                    <div>
                                        <p class="text-sm" style="color: var(--dark-text-medium);">Last 5 Results</p>
                                        <p id="lastFiveResults" class="text-xl font-bold" style="color: var(--dark-text-light);">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="small-dot" style="top: 15%; left: 20%; animation-delay: 0.5s;"></div>
                        <div class="small-dot" style="top: 85%; left: 80%; animation-delay: 1s;"></div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settingsSection" class="content-section">
                    <div class="card p-6 animate__animated animate__fadeInUp relative">
                        <h2 class="text-3xl font-bold text-center mb-4 relative" style="color: var(--dark-text-light);">
                            <span class="relative z-10 pulse-animation">Settings</span>
                            <span class="absolute top-1/2 left-0 w-full h-2 rounded-full" style="background: var(--dark-bg-primary);"></span>
                        </h2>
                        <div class="flex flex-col gap-4">
                            <div class="dashboard-card">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-chart-line text-lg" style="color: var(--purple-accent);"></i>
                                        <div>
                                            <p class="text-sm" style="color: var(--dark-text-medium);">Status</p>
                                            <p id="settingsTotalWins" class="text-sm" style="color: var(--dark-text-light);">Total Wins: 0</p>
                                            <p id="settingsTotalLosses" class="text-sm" style="color: var(--dark-text-light);">Total Losses: 0</p>
                                        </div>
                                    </div>
                                    <p id="eligibilityStatus" class="text-sm font-semibold" style="color: var(--yellow-accent);">Pending</p>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-bell text-lg" style="color: var(--purple-accent);"></i>
                                        <p class="text-sm" style="color: var(--dark-text-light);">Notifications</p>
                                    </div>
                                    <label class="mode-toggle">
                                        <input type="checkbox" id="notificationToggle">
                                        <span class="mode-slider"></span>
                                        <div class="mode-icons">
                                            <i class="fas fa-bell-slash" style="color: var(--dark-text-light);"></i>
                                            <i class="fas fa-bell" style="color: var(--dark-text-light);"></i>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-volume-up text-lg" style="color: var(--purple-accent);"></i>
                                        <p class="text-sm" style="color: var(--dark-text-light);">Sound</p>
                                    </div>
                                    <label class="mode-toggle">
                                        <input type="checkbox" id="soundToggle" checked>
                                        <span class="mode-slider"></span>
                                        <div class="mode-icons">
                                            <i class="fas fa-volume-mute" style="color: var(--dark-text-light);"></i>
                                            <i class="fas fa-volume-up" style="color: var(--dark-text-light);"></i>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="dashboard-card cursor-pointer transition" onclick="resetSettings()" style="background: var(--dark-bg-secondary); border: 1px solid var(--dark-border);">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-undo text-lg" style="color: var(--purple-accent);"></i>
                                        <p class="text-sm" style="color: var(--dark-text-light);">Reset Settings</p>
                                    </div>
                                    <span class="text-sm" style="color: var(--dark-text-light);">Reset</span>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-cog text-lg" style="color: var(--purple-accent);"></i>
                                        <p class="text-sm" style="color: var(--dark-text-light);">Prediction Mode</p>
                                    </div>
                                    <label class="mode-toggle">
                                        <input type="checkbox" id="predictionModeToggle">
                                        <span class="mode-slider"></span>
                                        <div class="mode-icons">
                                            <i class="fas fa-moon" style="color: var(--dark-text-light);"></i>
                                            <i class="fas fa-bolt" style="color: var(--dark-text-light);"></i>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div onclick="window.open('https://t.me/ORACLEXAIADMIN', '_blank')" class="dashboard-card cursor-pointer transition" style="background: var(--dark-bg-secondary); border: 1px solid var(--dark-border);">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <i class="fab fa-telegram text-lg" style="color: var(--purple-accent);"></i>
                                        <p class="text-sm" style="color: var(--dark-text-light);">Contact Admin</p>
                                    </div>
                                    <span class="text-sm" style="color: var(--dark-text-light);">Message</span>
                                </div>
                            </div>
                            <div class="contact-links">
                                <a href="https://t.me/ORACLEXAIADMIN" target="_blank" class="contact-link">
                                    <i class="fab fa-telegram" style="color: var(--purple-accent);"></i>
                                    <span style="color: var(--dark-text-light);">Telegram</span>
                                </a>
                            </div>
                        </div>
                        <div class="small-dot" style="top: 10%; left: 15%; animation-delay: 0.6s;"></div>
                        <div class="small-dot" style="top: 90%; left: 85%; animation-delay: 1.1s;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <ul>
                <li class="active">
                    <a href="#" data-section="homeSection">
                        <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
                        <span class="text">Home</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-section="historySection">
                        <span class="icon"><ion-icon name="time-outline"></ion-icon></span>
                        <span class="text">History</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-section="statsSection">
                        <span class="icon"><ion-icon name="bar-chart-outline"></ion-icon></span>
                        <span class="text">Stats</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-section="settingsSection">
                        <span class="icon"><ion-icon name="settings-outline"></ion-icon></span>
                        <span class="text">Settings</span>
                    </a>
                </li>
                <div class="indicator"></div>
            </ul>
        </div>

        <!-- Video Popup (still exists but no button to open it) -->
        <div id="videoPopup" class="popup">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">How To Use ORACLE X AI</h3>
                <button onclick="closeVideoPopup()" class="hover:opacity-80 transition" style="color: var(--dark-text-medium);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>
            </div>
        </div>

        <!-- Win Popup -->
        <div id="winPopup" class="win-popup">
            <div class="confetti-icon"></div>
            <h3 class="text-lg font-semibold mb-4">CONGRATULATIONS!</h3>
            <p class="mb-4">You won this prediction!</p>
            <p id="winDetails" class="mb-4"></p>
        </div>

        <!-- Loss Popup -->
        <div id="lossPopup" class="loss-popup">
            <div class="confetti-icon"></div>
            <h3 class="text-lg font-semibold mb-4">LOSS!</h3>
            <p class="mb-4">Unfortunately, you lost this prediction.</p>
            <p id="lossDetails" class="mb-4"></p>
        </div>

        <!-- Pattern Warning Popup -->
        <div id="patternWarningPopup" class="pattern-warning">
            <div class="confetti-icon"></div>
            <h3 class="text-lg font-semibold mb-4">PATTERN WARNING!</h3>
            <p class="mb-4">5 consecutive losses detected. Pattern not good. Please wait 15 minutes before playing again.</p>
            <button onclick="pausePredictions()" class="px-4 py-2 rounded-lg hover:opacity-80 transition" style="background: var(--red-accent); color: white;">CLOSE</button>
        </div>

        <!-- History Deleted Popup -->
        <div id="historyDeletedPopup" class="history-deleted-popup">
            <div class="confetti-icon"></div>
            <h3 class="text-lg font-semibold mb-4">HISTORY DELETED!</h3>
            <p class="mb-4">History has been successfully deleted.</p>
            <p id="historyDeleteDetails" class="mb-4"></p>
        </div>

        <!-- Play Resume Modal -->
        <div id="playResumeModal" class="play-resume">
            <div class="play-icon"><i class="fas fa-play"></i></div>
            <h3 class="text-lg font-semibold mb-4">Resume Playing</h3>
            <p class="mb-4">You can now resume predictions.</p>
            <button onclick="resumePlaying()" class="px-4 py-2 rounded-lg hover:opacity-80 transition" style="background: var(--green-accent); color: white;">Resume</button>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal">
            <h3 class="text-lg font-semibold mb-4">Confirm Action</h3>
            <p id="modalMessage" class="mb-4"></p>
            <div class="flex justify-end space-x-2">
                <button id="cancelModalBtn" class="px-4 py-2 rounded-lg hover:opacity-80 transition" style="background: var(--dark-bg-secondary); color: var(--dark-text-light);">Cancel</button>
                <button id="confirmModalBtn" class="px-4 py-2 rounded-lg hover:opacity-80 transition" style="background: var(--purple-accent); color: white;">Confirm</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules for Realtime Database and Authentication
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getDatabase, ref, get, child, set, update, remove, onValue } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js';
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';

        // Placeholder for Firebase Config (Canvas will inject this)
        const firebaseConfig = typeof __firebase_config !== 'undefined'
            ? JSON.parse(__firebase_config)
            : {
                  apiKey: "AIzaSyBS8SJNrWcrnNhxzgSnMhmLWslSnxJ3vXM",
                  authDomain: "newq-7386b.firebaseapp.com",
                  projectId: "newq-7386b",
                  storageBucket: "newq-7386b.firebase-storage.app", 
                  messagingSenderId: "939070208594",
                  appId: "1:939070208594:web:b7b952fb7ca541ab32fd8b",
                  databaseURL: "https://newq-7386b-default-rtdb.firebaseio.com/" 
                };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        
        // References to Firebase database nodes
        const accessKeysRef = ref(db, 'accessKeys'); 
        let userHistoryRef;
        let userSettingsRef;

        let currentUserUid = null;
        let isAuthReady = false;

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // --- Firebase Authentication ---
        async function initiateAuthentication() {
            try {
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase authentication initiated.");
            } catch (error) {
                console.error("Firebase Authentication initiation failed:", error);
                showToast("Authentication failed. Please try again.");
                document.getElementById('mainAppScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
            }
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserUid = user.uid;
                userHistoryRef = ref(db, `users/${currentUserUid}/predictionHistory`);
                userSettingsRef = ref(db, `users/${currentUserUid}/userSettings`);
                console.log("Firebase authentication successful. User UID:", currentUserUid);
                await loadUserDataFromFirebase(); 
            } else {
                console.log("User is signed out or authentication failed.");
                currentUserUid = null;
                document.getElementById('mainAppScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                if (predictionInterval) {
                    clearInterval(predictionInterval);
                    predictionInterval = null;
                }
            }
            isAuthReady = true;
        });

        document.addEventListener('DOMContentLoaded', initiateAuthentication);

        // --- Global variables for application state ---
        let historyData = [];
        let currentPredictionType = 'size';
        let predictionSwitchCounter = 0;
        const PREDICTION_SWITCH_THRESHOLD = 3;

        let streak = 0;
        let winLevel = 0;
        let lossStreak = 0;
        let consecutiveLosses = 0;
        let isPaused = false;
        let isPatternGood = true;
        const MAX_WIN_LEVEL = 3;

        let isSoundEnabled = true; 
        let isNotificationsEnabled = false;
        let isAdvancedMode = false;

        // --- Prediction Accuracy Controls & Dynamic Thresholds ---
        let MIN_CONFIDENCE_FOR_PREDICTION = 60; // Base confidence. This will adjust dynamically.
        const MIN_PATTERN_COHERENCE_TO_PREDICT = 0.3; // Very low score, force skip regardless of confidence
        const MIN_RSI_SIGNAL_DEVIATION = 10; // RSI needs to be outside 50 +/- 10 for a clear signal (40-60 range is neutral)
        const HIGH_VOLATILITY_THRESHOLD_ATR = 1.5; // ATR value above which volatility is considered high. Adjust based on observed game range.

        // --- Analytical Modules and Logics (Conceptual Simulation) ---
        // For demonstration, we'll keep a simplified structure for the 'modules'
        // In a real advanced AI, these would be complex, trained models.
        const analyticalModules = {};

        for (let i = 1; i <= 10; i++) { // Reduced modules for performance in browser, but conceptually still 'many'
            const moduleName = `DL_Mod${String(i).padStart(2, '0')}`;
            const logics = [];
            for (let j = 0; j < 50; j++) { // Reduced logics, but still a decent number for internal 'ensemble'
                logics.push((data, history) => {
                    // Simulating various deep learning inspired "logic cells"
                    let score = 0;
                    
                    // Input: current data and historical context
                    const recentNumbers = history.slice(0, 5).map(e => e.result);
                    const avgRecent = recentNumbers.filter(n => n !== '-').reduce((sum, n) => sum + n, 0) / (recentNumbers.filter(n => n !== '-').length || 1);

                    // Logic based on a combination of indicators and a simulated "weight"
                    if (data.trendStrength > 0.5) score += 0.2;
                    if (data.trendStrength < -0.5) score -= 0.2;
                    
                    if (data.rsi !== null) {
                        if (data.rsi > 70 && data.currentPredictionType === 'size' && data.sizePrediction === 'SMALL') score += 0.15;
                        if (data.rsi < 30 && data.currentPredictionType === 'size' && data.sizePrediction === 'BIG') score += 0.15;
                    }
                    
                    if (data.volatilityIndex < 0.5) score += 0.1; // Favor stability

                    if (data.patternStability > 0.7) score += 0.2; // High coherence is good
                    else if (data.patternStability < 0.4) score -= 0.2; // Low coherence is bad

                    // Simulated "Mean Reversion" logic
                    if (data.currentValue !== null && avgRecent !== null && Math.abs(data.currentValue - avgRecent) > 3) {
                        if (data.currentValue > avgRecent && data.sizePrediction === 'SMALL') score += 0.1; // Predict down if high and past avg
                        if (data.currentValue < avgRecent && data.sizePrediction === 'BIG') score += 0.1; // Predict up if low and past avg
                    }

                    // Introduce some randomness, simulating non-linear activation functions
                    score += (Math.random() - 0.5) * 0.1;

                    // Decision based on threshold
                    return score > (j % 10 / 100); // Dynamic threshold for each logic
                });
            }
            analyticalModules[moduleName] = { logics: logics };
        }

        // This function simulates running all analytical modules and their logics
        function runAnalyticalModules(predictionData, history) {
            let totalLogics = 0;
            let supportingLogics = 0;
            // Removed moduleSummary for UI, kept for potential internal debugging if needed.
            
            for (const moduleName in analyticalModules) {
                const module = analyticalModules[moduleName];
                module.logics.forEach(logic => {
                    totalLogics++;
                    if (logic(predictionData, history)) {
                        supportingLogics++;
                    }
                });
            }
            
            const overallSupportRate = totalLogics > 0 ? (supportingLogics / totalLogics) : 0;
            return { overallSupportRate }; // Return just the overall rate for confidence calculation
        }

        document.getElementById('notificationToggle').checked = isNotificationsEnabled;
        document.getElementById('soundToggle').checked = isSoundEnabled;
        document.getElementById('predictionModeToggle').checked = isAdvancedMode;

        // --- Firebase Data Loading and Saving ---
        async function loadUserDataFromFirebase() {
            if (!currentUserUid) {
                console.warn("loadUserDataFromFirebase called without currentUserUid. Skipping data load.");
                return;
            }

            try {
                const historySnapshot = await get(userHistoryRef);
                if (historySnapshot.exists()) {
                    historyData = historySnapshot.val();
                    if (typeof historyData === 'object' && !Array.isArray(historyData)) {
                        historyData = Object.values(historyData);
                    }
                    historyData.sort((a, b) => b.period - a.period);
                } else {
                    historyData = [];
                }

                const settingsSnapshot = await get(userSettingsRef);
                if (settingsSnapshot.exists()) {
                    const settings = settingsSnapshot.val();
                    isSoundEnabled = settings.isSoundEnabled !== undefined ? settings.isSoundEnabled : true;
                    isNotificationsEnabled = settings.isNotificationsEnabled !== undefined ? settings.isNotificationsEnabled : false;
                    isAdvancedMode = settings.isAdvancedMode !== undefined ? settings.isAdvancedMode : false;

                    document.getElementById('notificationToggle').checked = isNotificationsEnabled;
                    document.getElementById('soundToggle').checked = isSoundEnabled;
                    document.getElementById('predictionModeToggle').checked = isAdvancedMode;
                } else {
                    await saveUserSettingsToFirebase();
                }

                updateHistory();
                updateStats();

            } catch (error) {
                console.error("Error loading user data from Firebase:", error);
                showToast("Failed to load your personal data. Please refresh.");
            }
        }

        async function saveHistoryToFirebase() {
            if (!currentUserUid) {
                console.warn("saveHistoryToFirebase called without currentUserUid. Skipping data save.");
                return;
            }
            try {
                await set(userHistoryRef, historyData);
                console.log("History saved to Firebase.");
            } catch (error) {
                console.error("Error saving history to Firebase:", error);
            }
        }

        async function saveUserSettingsToFirebase() {
            if (!currentUserUid) {
                console.warn("saveUserSettingsToFirebase called without currentUserUid. Skipping settings save.");
                return;
            }
            const settings = {
                isSoundEnabled: isSoundEnabled,
                isNotificationsEnabled: isNotificationsEnabled,
                isAdvancedMode: isAdvancedMode
            };
            try {
                await set(userSettingsRef, settings);
                console.log("User settings saved to Firebase.");
            } catch (error) {
                console.error("Error saving user settings to Firebase:", error);
            }
        }

        // --- Navigation Logic for Main App ---
        const navItems = document.querySelectorAll('.navigation ul li');
        const sections = document.querySelectorAll('.content-section');

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                navItems.forEach(nav => nav.classList.remove('active'));
                sections.forEach(section => section.classList.remove('active'));
                
                item.classList.add('active');
                const sectionId = item.querySelector('a').getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // --- Popup and Modal Functions ---
        function openVideoPopup() {
            document.getElementById('videoPopup').classList.add('active');
        }

        function closeVideoPopup() {
            document.getElementById('videoPopup').classList.remove('active');
        }

        function showWinPopup(period, predicted, actual, predictionType) {
            document.getElementById('winDetails').textContent = `Period: ${period} | Predicted ${predictionType === 'size' ? 'Size' : 'Color'}: ${predicted} | Actual ${predictionType === 'size' ? 'Size' : 'Color'}: ${actual}`;
            document.getElementById('winPopup').classList.add('active');
            if (isSoundEnabled) {
                speak("congratulations You Win power by ORACLE X AI");
            }
            setTimeout(() => {
                document.getElementById('winPopup').classList.remove('active');
            }, 5000);
        }

        function showLossPopup(period, predicted, actual, predictionType) {
            document.getElementById('lossDetails').textContent = `Period: ${period} | Predicted ${predictionType === 'size' ? 'Size' : 'Color'}: ${predicted} | Actual ${predictionType === 'size' ? 'Size' : 'Color'}: ${actual}`;
            document.getElementById('lossPopup').classList.add('active');
            if (isSoundEnabled) {
                speak("Sorry you Loss pattern not stables or my mistake");
            }
            setTimeout(() => {
                document.getElementById('lossPopup').classList.remove('active');
            }, 5000);
        }

        function showPatternWarningPopup() {
            document.getElementById('patternWarningPopup').classList.add('active');
        }

        function showHistoryDeletedPopup(message) {
            document.getElementById('historyDeleteDetails').textContent = message;
            document.getElementById('historyDeletedPopup').classList.add('active');
            if (isSoundEnabled) {
                speak("History has been deleted successfully");
            }
            setTimeout(() => {
                document.getElementById('historyDeletedPopup').classList.remove('active');
            }, 3000);
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.volume = 1;
                utterance.rate = 1;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            }
        }

        function showConfirmModal(message, onConfirm) {
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('active');
            const confirmBtn = document.getElementById('confirmModalBtn');
            const cancelBtn = document.getElementById('cancelModalBtn');

            const confirmHandler = () => {
                onConfirm();
                document.getElementById('confirmModal').classList.remove('active');
                confirmBtn.removeEventListener('click', confirmHandler);
                cancelBtn.removeEventListener('click', cancelHandler);
            };

            const cancelHandler = () => {
                document.getElementById('confirmModal').classList.remove('active');
                confirmBtn.removeEventListener('click', confirmHandler);
                cancelBtn.removeEventListener('click', cancelHandler);
            };

            confirmBtn.addEventListener('click', confirmHandler);
            cancelBtn.addEventListener('click', cancelHandler);
        }

        function showPlayResumeModal() {
            document.getElementById('playResumeModal').classList.add('active');
        }

        function pausePredictions() {
            document.getElementById('patternWarningPopup').classList.remove('active');
            clearInterval(predictionInterval);
            predictionInterval = null;
            isPaused = true;
            isPatternGood = false;
            document.getElementById("currentPredictionResult").textContent = "PAUSED";
            document.getElementById("predictionTitle").textContent = "Prediction";
            setTimeout(() => {
                showPlayResumeModal();
            }, 15 * 60 * 1000); // 15 minutes
            showToast("Predictions paused for 15 minutes due to unstable pattern.");
        }

        function resumePlaying() {
            document.getElementById('playResumeModal').classList.remove('active');
            isPaused = false;
            isPatternGood = true;
            if (!predictionInterval) {
                predictionInterval = setInterval(updatePrediction, 5000);
            }
            updatePrediction();
        }

        // --- Settings Handlers ---
        document.getElementById('notificationToggle').addEventListener('change', async (e) => {
            isNotificationsEnabled = e.target.checked;
            await saveUserSettingsToFirebase();
            if (isNotificationsEnabled && Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
        });

        document.getElementById('soundToggle').addEventListener('change', async (e) => {
            isSoundEnabled = e.target.checked;
            await saveUserSettingsToFirebase();
        });

        document.getElementById('predictionModeToggle').addEventListener('change', async (e) => {
            isAdvancedMode = e.target.checked;
            await saveUserSettingsToFirebase();
        });

        function resetSettings() {
            showConfirmModal("Are you sure you want to reset all settings to default?", async () => {
                isSoundEnabled = true;
                isNotificationsEnabled = false;
                isAdvancedMode = false;
                await saveUserSettingsToFirebase();
                document.getElementById('notificationToggle').checked = false;
                document.getElementById('soundToggle').checked = true;
                document.getElementById('predictionModeToggle').checked = false;
                updatePrediction();
            });
        }
        
        /**
         * Calculates the Relative Strength Index (RSI).
         */
        function calculateRSI(history, period = 14) {
            const relevantResults = history
                .filter(entry => entry.result !== '-' && typeof entry.result === 'number' && !isNaN(entry.result))
                .map(entry => entry.result)
                .reverse();
            
            if (relevantResults.length < period + 1) return null;

            let gains = [];
            let losses = [];
            for (let i = 1; i < relevantResults.length; i++) {
                const change = relevantResults[i] - relevantResults[i - 1];
                gains.push(Math.max(0, change));
                losses.push(Math.max(0, -change));
            }

            let avgGain = gains.slice(0, period).reduce((sum, val) => sum + val, 0) / period;
            let avgLoss = losses.slice(0, period).reduce((sum, val) => sum + val, 0) / period;

            for (let i = period; i < gains.length; i++) {
                avgGain = ((avgGain * (period - 1)) + gains[i]) / period;
                avgLoss = ((avgLoss * (period - 1)) + losses[i]) / period;
            }
            
            if (avgLoss === 0) return (avgGain > 0 ? 100 : 50);
            let rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        /**
         * Calculates the Average True Range (ATR) for volatility.
         */
        function calculateATR(history, period = 14) {
            const relevantResults = history
                .filter(entry => entry.result !== '-' && typeof entry.result === 'number' && !isNaN(entry.result))
                .map(entry => entry.result)
                .reverse();

            if (relevantResults.length < period + 1) return null;

            let trueRanges = [];
            for (let i = 1; i < relevantResults.length; i++) {
                const high = relevantResults[i];
                const low = relevantResults[i]; // For single number, high=low. Consider using actual high/low if available.
                const prevClose = relevantResults[i-1];
                
                const tr1 = Math.abs(high - low);
                const tr2 = Math.abs(high - prevClose);
                const tr3 = Math.abs(low - prevClose);
                trueRanges.push(Math.max(tr1, tr2, tr3));
            }

            if (trueRanges.length < period) return null;

            let atr = trueRanges.slice(0, period).reduce((sum, val) => sum + val, 0) / period;
            for (let i = period; i < trueRanges.length; i++) {
                atr = ((atr * (period - 1)) + trueRanges[i]) / period;
            }
            return atr;
        }

        /**
         * Calculates Simple Moving Average (SMA).
         */
        function calculateSMA(data, period) {
            if (!data || data.length < period) return null;
            return data.slice(0, period).reduce((sum, val) => sum + val, 0) / period;
        }

        // --- Advanced Pattern Analysis ---
        function analyzePattern(history, type) {
            const LOOKBACK_PERIOD = 30; // Increased lookback for more robust analysis
            if (history.length < LOOKBACK_PERIOD) {
                // Return default/neutral values if not enough history
                return { 
                    isStable: false, patternScore: 0.5, patternCoherence: 0.5,
                    trendStrength: 0, volatility: 0, rsi: null, 
                    sma5: null, sma10: null, sma20: null,
                    outcomeBalance: 0.5, alternationScore: 0.5,
                    isTrending: false, isOverbought: false, isOversold: false
                };
            }
            const recent = history.slice(0, LOOKBACK_PERIOD);

            let countType1 = 0;
            let countType2 = 0;
            let currentStreakLength = 0;
            let maxStreakLength = 0;
            let lastResultType = null;
            let alternations = 0;
            
            const numbersOnly = recent.filter(entry => entry.result !== '-' && typeof entry.result === 'number' && !isNaN(entry.result)).map(entry => entry.result).reverse(); // Oldest first
            if (numbersOnly.length === 0) {
                 return { /* default values */ };
            }

            // Iterate over relevant entries for pattern analysis (size/color specific)
            const relevantEntriesForType = type === 'size'
                ? recent.filter(entry => entry.sizeResultType !== '-')
                : recent.filter(entry => entry.colorResultType !== '-');

            if (relevantEntriesForType.length === 0) {
                 return { /* default values */ };
            }

            lastResultType = type === 'size' ? relevantEntriesForType[0].sizeResultType : relevantEntriesForType[0].colorResultType;
            currentStreakLength = 1;
            maxStreakLength = 1;

            for (let i = 0; i < relevantEntriesForType.length; i++) {
                const currentEntry = relevantEntriesForType[i];
                const currentType = type === 'size' ? currentEntry.sizeResultType : currentEntry.colorResultType;

                if (type === 'size') {
                    if (currentType === "BIG") countType1++;
                    else if (currentType === "SMALL") countType2++;
                } else if (type === 'color') {
                    if (currentType === "GREEN") countType1++;
                    else if (currentType === "RED") countType2++;
                }

                if (i > 0) {
                    if (currentType === lastResultType) {
                        currentStreakLength++;
                        maxStreakLength = Math.max(maxStreakLength, currentStreakLength);
                    } else {
                        alternations++;
                        currentStreakLength = 1;
                    }
                }
                lastResultType = currentType;
            }

            const totalRelevantEntries = countType1 + countType2;
            const totalConsideredEntries = relevantEntriesForType.length;

            const outcomeBalance = totalRelevantEntries > 0 ? Math.abs(countType1 - countType2) / totalRelevantEntries : 0;
            const alternationScore = totalConsideredEntries > 1 ? alternations / (totalConsideredEntries - 1) : 0;
            const normalizedMaxStreak = totalConsideredEntries > 0 ? maxStreakLength / totalConsideredEntries : 0;

            const rsiValue = calculateRSI(history, 14);
            const atrValue = calculateATR(history, 14); // ATR as primary volatility measure

            const sma5 = calculateSMA(numbersOnly, 5);
            const sma10 = calculateSMA(numbersOnly, 10);
            const sma20 = calculateSMA(numbersOnly, 20);

            // Trend Strength: More nuanced, based on multiple SMA relationships
            let trendStrength = 0; // -1 (strong down), 0 (sideways), 1 (strong up)
            let isTrending = false;
            if (sma5 !== null && sma10 !== null && sma20 !== null) {
                if (sma5 > sma10 && sma10 > sma20 && sma5 - sma10 > 0.5) { // Clear uptrend
                    trendStrength = 1;
                    isTrending = true;
                } else if (sma5 < sma10 && sma10 < sma20 && sma10 - sma5 > 0.5) { // Clear downtrend
                    trendStrength = -1;
                    isTrending = true;
                } else if (Math.abs(sma5 - sma10) < 0.2 && Math.abs(sma10 - sma20) < 0.2) { // Sideways/Consolidation
                    trendStrength = 0;
                }
            } else if (numbersOnly.length >= 5) { // Basic trend if not enough for all SMAs
                const last5Avg = calculateSMA(numbersOnly, 5);
                const first5Avg = calculateSMA(numbersOnly.slice(numbersOnly.length - 5).reverse(), 5); // Average of first 5 in recent slice
                if (last5Avg !== null && first5Avg !== null) {
                    if (last5Avg > first5Avg + 0.5) { trendStrength = 0.5; isTrending = true; }
                    else if (last5Avg < first5Avg - 0.5) { trendStrength = -0.5; isTrending = true; }
                }
            }

            // Pattern Coherence Score: A composite metric of predictability
            let patternCoherence = 0;
            patternCoherence += (1 - outcomeBalance) * 0.2; // Balanced outcomes are more predictable
            patternCoherence += alternationScore * 0.2;     // Regular alternation suggests pattern
            patternCoherence += (1 - normalizedMaxStreak) * 0.2; // Avoid extreme one-sided streaks
            patternCoherence += (atrValue !== null ? (1 - Math.min(atrValue / 5, 1)) : 0.1) * 0.2; // Low volatility is coherent

            if (rsiValue !== null) {
                const rsiSignal = Math.abs(rsiValue - 50);
                if (rsiSignal > MIN_RSI_SIGNAL_DEVIATION) { // RSI indicates a strong direction
                    patternCoherence += Math.min(rsiSignal / 50, 1) * 0.1; // Contribution based on strength of RSI signal
                }
            }
            if (isTrending) {
                patternCoherence += Math.abs(trendStrength) * 0.1; // Contribution if there's a clear trend
            }

            patternCoherence = Math.max(0, Math.min(1, patternCoherence));

            // Overbought/Oversold status
            const isOverbought = rsiValue !== null && rsiValue > 70;
            const isOversold = rsiValue !== null && rsiValue < 30;

            return { 
                isStable: patternCoherence > MIN_PATTERN_COHERENCE_TO_PREDICT,
                patternScore: patternCoherence, // Primary metric for overall pattern health
                patternCoherence: patternCoherence,
                trendStrength: trendStrength,
                volatility: atrValue, // Using ATR as the primary volatility indicator
                rsi: rsiValue,
                sma5: sma5,
                sma10: sma10,
                sma20: sma20,
                outcomeBalance: outcomeBalance, 
                alternationScore: alternationScore,
                isTrending: isTrending,
                isOverbought: isOverbought,
                isOversold: isOversold
            };
        }

        // --- Ensemble Prediction & Confidence Calculation ---
        async function ultraAIPredictSize(history, periodNumber) {
            const patternAnalysis = analyzePattern(history, 'size');
            const { patternCoherence, trendStrength, volatility, rsi, sma5, sma10, isOverbought, isOversold, outcomeBalance, alternationScore } = patternAnalysis;

            // Core prediction influenced by period and pattern coherence
            let predictionValue = (periodNumber * 7) % 10;
            predictionValue += (patternCoherence * 3) * (Math.random() - 0.5); // More deterministic with high coherence

            let prediction = predictionValue >= 5 ? "BIG" : "SMALL";
            let baseConfidence = 0.5;

            // Ensemble Confidence Factors: Each factor simulates an "expert" opinion
            let trendExpertConfidence = 0;
            if (trendStrength > 0.5) trendExpertConfidence = (prediction === "BIG" ? 0.3 : -0.15); // Strong uptrend, favor BIG
            else if (trendStrength < -0.5) trendExpertConfidence = (prediction === "SMALL" ? 0.3 : -0.15); // Strong downtrend, favor SMALL

            let momentumExpertConfidence = 0;
            if (rsi !== null) {
                if (isOverbought) momentumExpertConfidence = (prediction === "SMALL" ? 0.2 : -0.1); // Overbought, favor reversal (SMALL)
                else if (isOversold) momentumExpertConfidence = (prediction === "BIG" ? 0.2 : -0.1); // Oversold, favor reversal (BIG)
            }

            let stabilityExpertConfidence = (patternCoherence - 0.5) * 0.4; // High coherence adds confidence
            stabilityExpertConfidence -= (volatility !== null ? (volatility / HIGH_VOLATILITY_THRESHOLD_ATR) * 0.1 : 0); // High volatility reduces confidence

            let alternationExpertConfidence = (alternationScore - 0.5) * 0.1; // Favor patterns close to 0.5 alternation

            // Aggregate confidence from "experts"
            let totalConfidence = baseConfidence + trendExpertConfidence + momentumExpertConfidence + stabilityExpertConfidence + alternationExpertConfidence;

            // Adaptive Bias based on recent performance (simulated self-improvement)
            const recentWinRate = history.filter(h => h.resultStatus === 'WIN').length / (history.filter(h => h.resultStatus !== 'Pending' && h.resultStatus !== 'Skipped').length || 1);
            if (recentWinRate > 0.7) totalConfidence += 0.05; // Boost if AI is performing well recently
            else if (recentWinRate < 0.4) totalConfidence -= 0.05; // Reduce if performing poorly

            // Apply strategy inversion at MAX_WIN_LEVEL, but with intelligence
            if (winLevel >= MAX_WIN_LEVEL) {
                const inversePrediction = prediction === "BIG" ? "SMALL" : "BIG";
                // Only invert if pattern coherence is not extremely low OR if it's a very strong reversal signal (e.g., extreme RSI)
                if (patternCoherence > 0.6 || (isOverbought && prediction === "BIG") || (isOversold && prediction === "SMALL")) {
                    prediction = inversePrediction;
                    totalConfidence = Math.max(0.3, totalConfidence * 0.7); // Confidence penalty for strategic reversal
                } else {
                    // If not ideal conditions for reversal, stick to original but with higher caution
                    totalConfidence = Math.max(0.2, totalConfidence * 0.8);
                }
            }

            // Final clamp and "quantum jump" for extreme uncertainty
            totalConfidence = Math.max(0.1, Math.min(0.98, totalConfidence));

            if (totalConfidence * 100 < 40 && Math.random() < (0.4 - (totalConfidence * 100) / 100)) { 
                 prediction = prediction === "BIG" ? "SMALL" : "BIG";
                 totalConfidence *= 0.5;
            }

            return { prediction, confidence: totalConfidence * 100 };
        }

        async function ultraAIPredictColor(history, periodNumber) {
            const patternAnalysis = analyzePattern(history, 'color');
            const { patternCoherence, trendStrength, volatility, rsi, sma5, sma10, isOverbought, isOversold, outcomeBalance, alternationScore } = patternAnalysis;

            let recentColors = history.filter(h => h.colorResultType !== "-").slice(0, 15);
            let redCount = 0;
            let greenCount = 0;
            let violetCount = 0;
            let weight = 1;

            for (let i = recentColors.length - 1; i >= 0; i--) {
                let color = recentColors[i].colorResultType;
                if (color === "RED") redCount += weight;
                else if (color === "GREEN") greenCount += weight;
                else if (color === "VIOLET") violetCount += weight;
                weight *= 1.2;
            }

            let rawPrediction;
            if (greenCount > redCount * 1.2) rawPrediction = "GREEN";
            else if (redCount > greenCount * 1.2) rawPrediction = "RED";
            else rawPrediction = Math.random() < 0.5 ? "RED" : "GREEN";

            if (trendStrength > 0.15 && rawPrediction === "GREEN") rawPrediction = "GREEN";
            else if (trendStrength < -0.15 && rawPrediction === "RED") rawPrediction = "RED";
            
            let prediction = rawPrediction;

            let baseConfidence = 0.5;
            let trendExpertConfidence = 0;
            if (trendStrength > 0.5) trendExpertConfidence = (prediction === "GREEN" ? 0.3 : -0.15);
            else if (trendStrength < -0.5) trendExpertConfidence = (prediction === "RED" ? 0.3 : -0.15);

            let momentumExpertConfidence = 0;
            if (rsi !== null) {
                if (isOverbought) momentumExpertConfidence = (prediction === "RED" ? 0.2 : -0.1);
                else if (isOversold) momentumExpertConfidence = (prediction === "GREEN" ? 0.2 : -0.1);
            }

            let stabilityExpertConfidence = (patternCoherence - 0.5) * 0.4;
            stabilityExpertConfidence -= (volatility !== null ? (volatility / HIGH_VOLATILITY_THRESHOLD_ATR) * 0.1 : 0);

            let alternationExpertConfidence = (alternationScore - 0.5) * 0.1;

            let totalConfidence = baseConfidence + trendExpertConfidence + momentumExpertConfidence + stabilityExpertConfidence + alternationExpertConfidence;

            const recentWinRate = history.filter(h => h.resultStatus === 'WIN').length / (history.filter(h => h.resultStatus !== 'Pending' && h.resultStatus !== 'Skipped').length || 1);
            if (recentWinRate > 0.7) totalConfidence += 0.05;
            else if (recentWinRate < 0.4) totalConfidence -= 0.05;

            // Apply strategy inversion at MAX_WIN_LEVEL, but with intelligence
            if (winLevel >= MAX_WIN_LEVEL) {
                const inversePrediction = prediction === "RED" ? "GREEN" : "RED";
                if (patternCoherence > 0.6 || (isOverbought && prediction === "GREEN") || (isOversold && prediction === "RED")) {
                    prediction = inversePrediction;
                    totalConfidence = Math.max(0.3, totalConfidence * 0.7);
                } else {
                    totalConfidence = Math.max(0.2, totalConfidence * 0.8);
                }
            }

            totalConfidence = Math.max(0.1, Math.min(0.98, totalConfidence));

            if (totalConfidence * 100 < 40 && Math.random() < (0.4 - (totalConfidence * 100) / 100)) {
                prediction = prediction === "RED" ? "GREEN" : "RED";
                totalConfidence *= 0.5;
            }

            return { prediction, confidence: totalConfidence * 100 };
        }

        function determineColor(number) {
            if (number === 0 || number === 5) return 'VIOLET';
            if ([1, 3, 7, 9].includes(number)) return 'GREEN';
            if ([2, 4, 6, 8].includes(number)) return 'RED';
            return 'UNKNOWN';
        }

        async function fetchGameResult() {
            try {
                let response = await fetch("https://api.bdg88zf.com/api/webapi/GetNoaverageEmerdList", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        pageSize: 10,
                        pageNo: 1,
                        typeId: 1,
                        language: 0,
                        random: "4a0522c6ecd8410496260e686be2a57c",
                        signature: "334B5E70A0C9B8918B0B15E517E2069C",
                        timestamp: Math.floor(Date.now() / 1000)
                    })
                });
                let data = await response.json();
                return data?.data?.list?.[0] || null;
            } catch (e) {
                console.error("API Error fetching game result:", e);
                updateServerStatus(false);
                return null;
            }
        }

        function updateServerStatus(isConnected) {
            const statusElement = document.getElementById('serverStatus');
            const indicator = document.getElementById('serverStatusIndicator');
            if (statusElement && indicator) {
                if (isConnected) {
                    statusElement.textContent = "Connected";
                    indicator.classList.add('animate-ping');
                    indicator.style.backgroundColor = 'var(--green-accent)';
                    indicator.classList.remove('bg-gray-500');
                } else {
                    statusElement.textContent = "Disconnected";
                    indicator.classList.remove('animate-ping');
                    indicator.style.backgroundColor = 'var(--red-accent)';
                    indicator.classList.add('bg-gray-500');
                }
            }
        }

        function showToast(message) {
            const toast = document.createElement("div");
            toast.className = "toast";
            toast.innerText = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        let predictionInterval;

        async function updatePrediction() {
            if (isPaused || !currentUserUid) { 
                console.log("Prediction skipped: paused or no user UID.");
                return;
            }

            const latestApiResult = await fetchGameResult();
            if (!latestApiResult) {
                console.warn("No API result or API error. Skipping prediction cycle.");
                return;
            }

            updateServerStatus(true);

            const apiIssueNumber = String(latestApiResult.issueNumber);
            const apiActualNumber = Number(latestApiResult.number);
            const currentApiPeriodShort = apiIssueNumber.slice(-4);

            let mostRecentPendingEntry = historyData.length > 0 ? historyData.find(entry => entry.resultStatus === "Pending") : null;
            
            if (mostRecentPendingEntry && mostRecentPendingEntry.period === currentApiPeriodShort) {
                console.log(`Updating pending prediction for period ${currentApiPeriodShort}`);
                const actualSizeType = apiActualNumber >= 5 ? 'BIG' : 'SMALL';
                const actualColorType = determineColor(apiActualNumber);

                mostRecentPendingEntry.result = apiActualNumber;
                mostRecentPendingEntry.sizeResultType = actualSizeType;
                mostRecentPendingEntry.colorResultType = actualColorType;

                let match = false;
                let predictedValue, actualValue;

                if (mostRecentPendingEntry.predictionType === 'size') {
                    match = (actualSizeType === mostRecentPendingEntry.sizePrediction);
                    predictedValue = mostRecentPendingEntry.sizePrediction;
                    actualValue = actualSizeType;
                } else if (mostRecentPendingEntry.predictionType === 'color') {
                    match = (actualColorType === mostRecentPendingEntry.colorPrediction);
                    predictedValue = mostRecentPendingEntry.colorPrediction;
                    actualValue = actualColorType;
                }

                mostRecentPendingEntry.resultStatus = match ? 'WIN' : 'LOSS';

                if (match) {
                    winLevel = Math.min(winLevel + 1, MAX_WIN_LEVEL);
                    streak++;
                    lossStreak = 0;
                    consecutiveLosses = 0;
                    showWinPopup(mostRecentPendingEntry.period, predictedValue, actualValue, mostRecentPendingEntry.predictionType);
                } else {
                    winLevel = 0;
                    streak = 0;
                    lossStreak++;
                    consecutiveLosses++;
                    showLossPopup(mostRecentPendingEntry.period, predictedValue, actualValue, mostRecentPendingEntry.predictionType);
                    if (consecutiveLosses >= 5) {
                        showPatternWarningPopup();
                        isPatternGood = false;
                    }
                }

                historyData.sort((a, b) => b.period - a.period);

                await saveHistoryToFirebase();
                updateHistory();
                updateStats();
            }

            const nextPeriodFull = (BigInt(apiIssueNumber) + 1n).toString();
            const nextPeriodShort = nextPeriodFull.slice(-4);

            const alreadyPredictedForNextPeriod = historyData.some(entry => 
                entry.period === nextPeriodShort && 
                (entry.resultStatus === "Pending" || entry.resultStatus === "Skipped")
            );

            if (alreadyPredictedForNextPeriod) {
                console.log(`Prediction for period ${nextPeriodShort} already pending or skipped. Skipping new prediction generation.`);
                document.getElementById("currentPeriod").textContent = nextPeriodShort;
                const existingPrediction = historyData.find(entry => entry.period === nextPeriodShort && entry.resultStatus === "Pending");
                if (existingPrediction) {
                    document.getElementById("currentPredictionResult").textContent = existingPrediction.predictionType === 'size' ? existingPrediction.sizePrediction : existingPrediction.colorPrediction;
                    document.getElementById("predictionTitle").textContent = existingPrediction.predictionType === 'size' ? "Size Pred." : "Color Pred.";
                    const confidenceFillElement = document.getElementById("confidenceFill");
                    if (confidenceFillElement) {
                        confidenceFillElement.style.width = `${existingPrediction.confidence}%`;
                        confidenceFillElement.classList.remove('red', 'green', 'violet');
                        if (existingPrediction.predictionType === 'size') {
                            confidenceFillElement.classList.add(existingPrediction.sizePrediction === 'BIG' ? 'green' : 'red');
                        } else {
                             confidenceFillElement.classList.add(existingPrediction.colorPrediction.toLowerCase());
                        }
                    }
                    const confidenceTextElement = document.getElementById("confidenceText");
                    if (confidenceTextElement) confidenceTextElement.textContent = `Confidence: ${existingPrediction.confidence.toFixed(0)}%`;

                } else {
                     document.getElementById("currentPredictionResult").textContent = "SKIPPED";
                     document.getElementById("predictionTitle").textContent = "Prediction";
                     const confidenceFillElement = document.getElementById("confidenceFill");
                     if (confidenceFillElement) {
                         confidenceFillElement.style.width = `0%`;
                         confidenceFillElement.classList.remove('red', 'green', 'violet');
                     }
                     const skippedEntry = historyData.find(entry => entry.period === nextPeriodShort && entry.resultStatus === "Skipped");
                     document.getElementById("confidenceText").textContent = `Smart Skip: ${skippedEntry ? skippedEntry.skipReason : 'Unknown Reason'}`;
                }
                return; 
            }

            const typeForThisPeriod = currentPredictionType;
            let currentPredictionValue = "N/A";
            let sizePredictionValue = "N/A";
            let colorPredictionValue = "N/A";
            let confidenceValue = 0;
            let confidenceColorClass = '';

            const patternAnalysisForNext = analyzePattern(historyData, typeForThisPeriod);
            const { patternCoherence, volatility, rsi, trendStrength, isTrending, isOverbought, isOversold } = patternAnalysisForNext;

            const predictionData = {
                period: parseInt(nextPeriodShort), 
                momentumScore: trendStrength,
                volatilityIndex: volatility, 
                patternStability: patternCoherence, 
                currentValue: apiActualNumber,
                isUpwardTrend: trendStrength > 0, 
                successRate: (historyData.filter(item => item.resultStatus === 'WIN').length / (historyData.filter(item => item.resultStatus === 'WIN' || item.resultStatus === 'LOSS').length || 1)),
                currentPredictionType: typeForThisPeriod, 
                rsi: rsi,
                sizePrediction: (typeForThisPeriod === 'size' ? 'N/A' : null), // Temp placeholder for logic consistency
                colorPrediction: (typeForThisPeriod === 'color' ? 'N/A' : null) // Temp placeholder for logic consistency
            };

            const { overallSupportRate } = runAnalyticalModules(predictionData, historyData); 

            if (typeForThisPeriod === 'size') {
                const aiSizeDecision = await ultraAIPredictSize(historyData, nextPeriodShort);
                sizePredictionValue = aiSizeDecision.prediction;
                currentPredictionValue = sizePredictionValue;
                confidenceValue = aiSizeDecision.confidence;
                confidenceColorClass = sizePredictionValue === 'BIG' ? 'green' : 'red';
                const predictionTitleElement = document.getElementById("predictionTitle");
                if (predictionTitleElement) predictionTitleElement.textContent = "Size Pred.";
            } else {
                const aiColorDecision = await ultraAIPredictColor(historyData, nextPeriodShort);
                colorPredictionValue = aiColorDecision.prediction;
                currentPredictionValue = colorPredictionValue;
                confidenceValue = aiColorDecision.confidence;
                confidenceColorClass = colorPredictionValue.toLowerCase();
                const predictionTitleElement = document.getElementById("predictionTitle");
                if (predictionTitleElement) predictionTitleElement.textContent = "Color Pred.";
            }

            // --- Maxx Advanced Skip Logic ---
            let skipReason = null;

            // Dynamic adjustment of MIN_CONFIDENCE_FOR_PREDICTION
            let currentMinConfidence = 60; // Base
            if (lossStreak > 0) { // If on a loss streak, require higher confidence
                currentMinConfidence = Math.min(90, currentMinConfidence + (lossStreak * 5)); // Max 90%
            } else if (streak > 0) { // If on a win streak, can be slightly more aggressive
                currentMinConfidence = Math.max(50, currentMinConfidence - (streak * 2)); // Min 50%
            }
            MIN_CONFIDENCE_FOR_PREDICTION = currentMinConfidence; // Update global for transparency

            if (patternCoherence < MIN_PATTERN_COHERENCE_TO_PREDICT) { 
                skipReason = "Highly Unstable Pattern";
            }
            
            if (volatility !== null && volatility > HIGH_VOLATILITY_THRESHOLD_ATR) {
                skipReason = skipReason ? skipReason + " & Extreme Volatility" : "Extreme Volatility";
            }

            if (rsi !== null && Math.abs(rsi - 50) < MIN_RSI_SIGNAL_DEVIATION) {
                skipReason = skipReason ? skipReason + " & Neutral RSI" : "Neutral RSI";
            }

            // Enhanced Conflicting Signals Detection
            const RECENT_HISTORY_FOR_CONFLICTS = historyData.filter(item => 
                (item.resultStatus === 'WIN' || item.resultStatus === 'LOSS') && 
                item.result !== '-' && !isNaN(Number(item.result))
            ).slice(0, 15); // Look at last 15 resolved entries

            if (RECENT_HISTORY_FOR_CONFLICTS.length >= 7) { // Need sufficient history
                let dominantRecentResult = null;
                const totalRecentResolved = RECENT_HISTORY_FOR_CONFLICTS.length;
                
                const currentTypeCounts = {
                    'BIG': RECENT_HISTORY_FOR_CONFLICTS.filter(e => e.sizeResultType === 'BIG').length,
                    'SMALL': RECENT_HISTORY_FOR_CONFLICTS.filter(e => e.sizeResultType === 'SMALL').length,
                    'RED': RECENT_HISTORY_FOR_CONFLICTS.filter(e => e.colorResultType === 'RED').length,
                    'GREEN': RECENT_HISTORY_FOR_CONFLICTS.filter(e => e.colorResultType === 'GREEN').length
                };

                if (typeForThisPeriod === 'size') {
                    if (currentTypeCounts['BIG'] / totalRecentResolved > 0.7) dominantRecentResult = 'BIG';
                    else if (currentTypeCounts['SMALL'] / totalRecentResolved > 0.7) dominantRecentResult = 'SMALL';
                } else if (typeForThisPeriod === 'color') {
                    if (currentTypeCounts['GREEN'] / totalRecentResolved > 0.7) dominantRecentResult = 'GREEN';
                    else if (currentTypeCounts['RED'] / totalRecentResolved > 0.7) dominantRecentResult = 'RED';
                }

                // Conflict if AI prediction contradicts strong dominant recent outcome AND trend OR RSI
                if (dominantRecentResult) {
                    const isPredictionOppositeDominant = (currentPredictionValue === "BIG" && dominantRecentResult === "SMALL") ||
                                                        (currentPredictionValue === "SMALL" && dominantRecentResult === "BIG") ||
                                                        (currentPredictionValue === "GREEN" && dominantRecentResult === "RED") ||
                                                        (currentPredictionValue === "RED" && dominantRecentResult === "GREEN");
                    
                    const isTrendOpposite = (currentPredictionValue === "BIG" && trendStrength < -0.5) ||
                                            (currentPredictionValue === "SMALL" && trendStrength > 0.5) ||
                                            (currentPredictionValue === "GREEN" && trendStrength < -0.5) ||
                                            (currentPredictionValue === "RED" && trendStrength > 0.5);

                    const isRSIOpposite = (currentPredictionValue === "BIG" && isOverbought) ||
                                          (currentPredictionValue === "SMALL" && isOversold) ||
                                          (currentPredictionValue === "GREEN" && isOverbought) || // Green for overbought means expect drop (red)
                                          (currentPredictionValue === "RED" && isOversold);     // Red for oversold means expect rise (green)

                    if (isPredictionOppositeDominant && (isTrendOpposite || isRSIOpposite)) {
                        conflictingSignals = true;
                    }
                }
            }

            if (conflictingSignals) {
                skipReason = skipReason ? skipReason + " & Conflicting Signals" : "Conflicting Signals Detected";
            }

            // Final decision to skip
            if (consecutiveLosses >= 5 || !isPatternGood || confidenceValue < MIN_CONFIDENCE_FOR_PREDICTION || skipReason) {
                const finalSkipReason = skipReason || (confidenceValue < MIN_CONFIDENCE_FOR_PREDICTION ? `Low Confidence (${confidenceValue.toFixed(0)}%)` : "System Pause");
                console.log(`Smart Skip triggered for period ${nextPeriodShort}. Reason: ${finalSkipReason}. Required Confidence: ${MIN_CONFIDENCE_FOR_PREDICTION.toFixed(0)}%`);

                currentPredictionValue = "SKIPPED";
                document.getElementById("currentPeriod").textContent = nextPeriodShort;
                document.getElementById("currentPredictionResult").textContent = currentPredictionValue;
                const confidenceFillElement = document.getElementById("confidenceFill");
                if (confidenceFillElement) {
                    confidenceFillElement.style.width = `0%`;
                    confidenceFillElement.classList.remove('red', 'green', 'violet');
                }
                document.getElementById("confidenceText").textContent = `Smart Skip: ${finalSkipReason}`;

                historyData.unshift({
                    period: nextPeriodShort,
                    predictionType: typeForThisPeriod,
                    sizePrediction: sizePredictionValue,
                    colorPrediction: colorPredictionValue,
                    result: "-", 
                    sizeResultType: "-",
                    colorResultType: "-",
                    resultStatus: "Skipped",
                    confidence: confidenceValue,
                    skipReason: finalSkipReason
                });
                
                if (historyData.length > 20) { historyData.pop(); }
                await saveHistoryToFirebase();
                updateHistory();
                updateStats();
                showToast(`Prediction for period ${nextPeriodShort} skipped: ${finalSkipReason}.`);
                return;
            }
            // End of Maxx Advanced Skip Logic

            // If not skipped, then proceed with normal prediction
            document.getElementById("currentPeriod").textContent = nextPeriodShort;
            document.getElementById("currentPredictionResult").textContent = currentPredictionValue;
            
            const confidenceFillElement = document.getElementById("confidenceFill");
            if (confidenceFillElement) {
                confidenceFillElement.style.width = `${confidenceValue}%`;
                confidenceFillElement.classList.remove('red', 'green', 'violet'); 
                if (confidenceColorClass) {
                    confidenceFillElement.classList.add(confidenceColorClass);
                }
            }
            document.getElementById("confidenceText").textContent = `Confidence: ${confidenceValue.toFixed(0)}% (Min Req: ${MIN_CONFIDENCE_FOR_PREDICTION.toFixed(0)}%)`;

            historyData.unshift({
                period: nextPeriodShort,
                predictionType: typeForThisPeriod,
                sizePrediction: sizePredictionValue,
                colorPrediction: colorPredictionValue,
                result: "-",
                sizeResultType: "-",
                colorResultType: "-",
                resultStatus: "Pending",
                confidence: confidenceValue
            });

            if (historyData.length > 20) { historyData.pop(); }
            await saveHistoryToFirebase();

            predictionSwitchCounter++;
            if (predictionSwitchCounter >= PREDICTION_SWITCH_THRESHOLD) {
                currentPredictionType = (currentPredictionType === 'size' ? 'color' : 'size');
                predictionSwitchCounter = 0;
            }

            updateHistory();
            updateStats();

            if (isNotificationsEnabled && Notification.permission === 'granted') {
                if (typeForThisPeriod === 'size') {
                    new Notification(`New Size Prediction: ${sizePredictionValue}`, {
                        body: `Period: ${nextPeriodShort}\nConfidence: ${confidenceValue.toFixed(0)}%`,
                        icon: 'https://via.placeholder.com/32'
                    });
                } else if (typeForThisPeriod === 'color') {
                    new Notification(`New Color Prediction: ${colorPredictionValue}`, {
                        body: `Period: ${nextPeriodShort}\nConfidence: ${confidenceValue.toFixed(0)}%`,
                        icon: 'https://via.placeholder.com/32'
                    });
                }
            }
        }

        function updateHistory() {
            const historyContainer = document.getElementById('history');
            if (!historyContainer) return;
            historyContainer.innerHTML = '';

            historyData.forEach((entry, index) => {
                const status = entry.resultStatus.toLowerCase();
                const iconClass = {
                    win: 'fas fa-check-circle win-icon',
                    loss: 'fas fa-times-circle loss-icon',
                    pending: 'fas fa-hourglass-half pending-icon',
                    skipped: 'fas fa-ban skipped-icon'
                }[status] || 'fas fa-question-circle';
                const badgeClass = {
                    win: 'win-badge',
                    loss: 'loss-badge',
                    pending: 'pending-badge',
                    skipped: 'skipped-badge'
                }[status] || '';

                let predictionDisplay = '';
                let actualDisplay = '';
                
                if (entry.predictionType === 'size') {
                    predictionDisplay = `<span class="font-medium">Size:</span> <span class="px-2 py-1 rounded-full ${entry.sizePrediction.toLowerCase()}-badge">${entry.sizePrediction}</span>`;
                    if (entry.resultStatus !== "pending" && entry.resultStatus !== "skipped") {
                        actualDisplay = `<span class="font-medium">Actual Size: ${entry.sizeResultType}</span>`;
                    }
                } else if (entry.predictionType === 'color') {
                    const displayColorPrediction = entry.colorPrediction === 'VIOLET' ? (Math.random() < 0.5 ? 'RED' : 'GREEN') : entry.colorPrediction; 
                    predictionDisplay = `<span class="font-medium">Color:</span> <span class="px-2 py-1 rounded-full ${displayColorPrediction.toLowerCase()}-badge">${displayColorPrediction}</span>`;
                    if (entry.resultStatus !== "pending" && entry.resultStatus !== "skipped") {
                        actualDisplay = `<span class="font-medium">Actual Color: ${entry.colorResultType}</span>`;
                    }
                }

                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${status} flex items-center justify-between p-4 rounded-xl`;
                historyItem.innerHTML = `
                    <div class="watermark">ORACLE X AI</div>
                    <div class="flex items-center space-x-3 w-full">
                        <div class="status-icon ${badgeClass}">
                            <i class="${iconClass}"></i>
                        </div>
                        <div class="flex-grow">
                            <p class="text-lg font-semibold" style="color: var(--dark-text-light);">${entry.period}</p>
                            <div class="flex items-center text-sm space-x-2" style="color: var(--dark-text-medium);">
                                ${predictionDisplay}
                                ${entry.resultStatus !== "skipped" ? actualDisplay : ''}
                            </div>
                            ${entry.result !== "-" && entry.resultStatus !== "skipped" ? `<p class="text-sm mt-1" style="color: var(--dark-text-medium);">Resulting Number: ${entry.result}</p>` : ''}
                            ${entry.confidence && entry.resultStatus !== "skipped" ? `<p class="text-sm mt-1" style="color: var(--dark-text-medium);">Confidence: ${entry.confidence.toFixed(0)}%</p>` : ''}
                            <p class="text-sm capitalize mt-1" style="color: var(--dark-text-medium);">Status: ${status}</p>
                            ${entry.resultStatus === 'skipped' && entry.skipReason ? `<p class="text-xs italic mt-1" style="color: var(--dark-text-dark);">Reason: ${entry.skipReason}</p>` : ''}
                        </div>
                    </div>
                    <button class="delete-btn hover:opacity-80 transition" data-index="${index}" style="color: var(--dark-text-medium);">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                `;
                historyContainer.appendChild(historyItem);

                historyItem.querySelector('.delete-btn').addEventListener('click', () => {
                    showConfirmModal("Are you sure you want to delete this history item?", async () => {
                        const deletedPeriod = historyData[index].period;
                        historyData.splice(index, 1);
                        updateHistory();
                        updateStats();
                        await saveHistoryToFirebase();
                        showHistoryDeletedPopup(`Period ${deletedPeriod} deleted successfully`);
                    });
                });
            });

            let mostFrequent = '-';
            let leastFrequent = '-';
            const numberCounts = {};
            historyData.forEach(entry => {
                if (entry.result !== '-' && entry.resultStatus !== 'Skipped') {
                    numberCounts[entry.result] = (numberCounts[entry.result] || 0) + 1;
                }
            });
            const sortedCounts = Object.entries(numberCounts).sort((a, b) => b[1] - a[1]);
            if (sortedCounts.length > 0) {
                mostFrequent = sortedCounts[0][0];
                leastFrequent = sortedCounts[sortedCounts.length - 1][0];
            }
            const mostFrequentElement = document.getElementById('mostFrequent');
            if (mostFrequentElement) mostFrequentElement.textContent = mostFrequent;
            const leastFrequentElement = document.getElementById('leastFrequent');
            if (leastFrequentElement) leastFrequentElement.textContent = leastFrequent;
        }

        function updateStats() {
            const wins = historyData.filter(item => item.resultStatus === "WIN").length;
            const losses = historyData.filter(item => item.resultStatus === "LOSS").length;
            const total = wins + losses;
            const accuracy = total > 0 ? ((wins / total) * 100).toFixed(2) : 0;

            const homeWinRateElement = document.getElementById("homeWinRate");
            if (homeWinRateElement) homeWinRateElement.textContent = `${accuracy}%`;
            const totalWinBetsElement = document.getElementById("totalWinBets");
            if (totalWinBetsElement) totalWinBetsElement.textContent = wins;
            const totalLossBetsElement = document.getElementById("totalLossBets");
            if (totalLossBetsElement) totalLossBetsElement.textContent = losses;

            const statsTotalWinsElement = document.getElementById("statsTotalWins");
            if (statsTotalWinsElement) statsTotalWinsElement.textContent = wins;
            const statsTotalLossesElement = document.getElementById("statsTotalLosses");
            if (statsTotalLossesElement) statsTotalLossesElement.textContent = losses;
            const statsWinRateElement = document.getElementById("statsWinRate");
            if (statsWinRateElement) statsWinRateElement.textContent = `${accuracy}%`;
            const currentStreakElement = document.getElementById("currentStreak");
            if (currentStreakElement) currentStreakElement.textContent = streak;
            
            const lastFiveResolved = historyData.filter(item => item.resultStatus === 'WIN' || item.resultStatus === 'LOSS').slice(0, 5);
            const lastFiveResultsElement = document.getElementById("lastFiveResults");
            if (lastFiveResultsElement) lastFiveResultsElement.textContent = lastFiveResolved.map(item => item.resultStatus === 'WIN' ? 'W' : 'L').join(', ') || '-';

            const settingsTotalWinsElement = document.getElementById("settingsTotalWins");
            if (settingsTotalWinsElement) settingsTotalWinsElement.textContent = `Total Wins: ${wins}`;
            const settingsTotalLossesElement = document.getElementById("settingsTotalLosses");
            if (settingsTotalLossesElement) settingsTotalLossesElement.textContent = `Total Losses: ${losses}`;

            const eligibilityStatusElement = document.getElementById('eligibilityStatus');
            if (eligibilityStatusElement) {
                if (consecutiveLosses >= 5) {
                    eligibilityStatusElement.textContent = "UNSTABLE (Wait 15m)";
                    eligibilityStatusElement.style.color = 'var(--red-accent)';
                } else {
                    eligibilityStatusElement.textContent = "STABLE";
                    eligibilityStatusElement.style.color = 'var(--green-accent)';
                }
            }
        }

        document.getElementById('deleteAllHistoryBtn').addEventListener('click', () => {
            showConfirmModal("Are you sure you want to delete all history items?", async () => {
                historyData = [];
                streak = 0;
                winLevel = 0;
                lossStreak = 0;
                consecutiveLosses = 0;
                updateHistory();
                updateStats();
                await saveHistoryToFirebase();
                showHistoryDeletedPopup("All history deleted successfully");
            });
        });

        function requestNotificationPermission() {
             if (isNotificationsEnabled && Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
        }
       
        // --- Login Page JavaScript ---
        function getDeviceId() {
            let id = localStorage.getItem("device_id");
            if (!id) {
                if (crypto.randomUUID) {
                    id = crypto.randomUUID();
                } else {
                    id = 'id-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
                }
                localStorage.setItem("device_id", id);
            }
            return id;
        }

        function resetForm() {
            const accessKeyInput = document.getElementById("accessKey");
            const errorDiv = document.getElementById("error");
            const successDiv = document.getElementById("success");
            const loadingDiv = document.getElementById("loading");

            if (accessKeyInput) accessKeyInput.value = "";
            if (errorDiv) errorDiv.innerText = "";
            if (successDiv) successDiv.innerText = "";
            if (loadingDiv) loadingDiv.style.display = "none";
            gsap.to('#error', { opacity: 0, duration: 0.3 });
            gsap.to('#success', { opacity: 0, duration: 0.3 });
        }

        function displayLastKey() {
            const lastKeyElement = document.getElementById("lastKey");
            if (lastKeyElement) { 
                const lastKey = localStorage.getItem("last_key");
                lastKeyElement.innerText = lastKey ? `Last Key: ${lastKey}` : "Last Key: None";
            } else {
                console.error("Element with ID 'lastKey' not found.");
            }
        }

        window.handleLogin = async function () {
            const key = document.getElementById("accessKey").value.trim();
            const errorDiv = document.getElementById("error");
            const successDiv = document.getElementById("success");
            const loadingDiv = document.getElementById("loading");
            const userDeviceId = getDeviceId();

            if (errorDiv) errorDiv.innerText = "";
            if (successDiv) successDiv.innerText = "";
            if (loadingDiv) loadingDiv.style.display = "block";

            if (!key) {
                if (loadingDiv) loadingDiv.style.display = "none";
                if (errorDiv) errorDiv.innerText = "PLEASE ENTER ACCESS KEY.";
                gsap.to('#error', {
                    scale: 1,
                    opacity: 1,
                    duration: 0.5,
                    ease: 'elastic.out(1, 0.6)'
                });
                setTimeout(() => { resetForm(); }, 2000);
                return;
            }

            while (!isAuthReady || currentUserUid === null) {
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            try {
                console.log("handleLogin: Current Firebase User UID before fetching key:", auth.currentUser?.uid);

                const keySnapshot = await get(child(accessKeysRef, key));

                if (!keySnapshot.exists()) {
                    if (loadingDiv) loadingDiv.style.display = "none";
                    if (errorDiv) errorDiv.innerText = "INVALID ACCESS KEY.";
                    gsap.to('#error', { scale: 1, opacity: 1, duration: 0.5, ease: 'elastic.out(1, 0.6)' });
                    setTimeout(() => { resetForm(); }, 2000);
                    return;
                }

                const keyData = keySnapshot.val();
                const now = Date.now();

                if (!keyData.active) {
                    if (loadingDiv) loadingDiv.style.display = "none";
                    if (errorDiv) errorDiv.innerText = "KEY IS INACTIVE.";
                    gsap.to('#error', { scale: 1, opacity: 1, duration: 0.5, ease: 'elastic.out(1, 0.6)' });
                    setTimeout(() => { resetForm(); }, 2000);
                    return;
                }

                if (keyData.expiry < now) {
                    if (loadingDiv) loadingDiv.style.display = "none";
                    if (errorDiv) errorDiv.innerText = "KEY HAS EXPIRED.";
                    gsap.to('#error', { scale: 1, opacity: 1, duration: 0.5, ease: 'elastic.out(1, 0.6)' });
                    setTimeout(() => { resetForm(); }, 2000);
                    return;
                }

                if (keyData.deviceId) {
                    if (keyData.deviceId !== userDeviceId) {
                        if (loadingDiv) loadingDiv.style.display = "none";
                        if (errorDiv) errorDiv.innerText = `KEY BOUND TO ANOTHER DEVICE. YOUR ID: ${userDeviceId}`;
                        gsap.to('#error', { scale: 1, opacity: 1, duration: 0.5, ease: 'elastic.out(1, 0.6)' });
                        setTimeout(() => { resetForm(); }, 3000);
                        return;
                    }
                }

                if (successDiv) successDiv.innerText = "LOGIN SUCCESSFUL!";
                gsap.to('#success', {
                    scale: 1,
                    opacity: 1,
                    duration: 0.5,
                    ease: 'elastic.out(1, 0.6)'
                });
                localStorage.setItem('last_key', key);
                displayLastKey();
                
                const loginScreen = document.getElementById('loginScreen');
                const mainAppScreen = document.getElementById('mainAppScreen');
                if (loginScreen && mainAppScreen) {
                    gsap.to(loginScreen, {
                        opacity: 0,
                        duration: 0.8,
                        ease: 'power2.out',
                        onComplete: () => {
                            loginScreen.style.display = 'none';
                            mainAppScreen.style.display = 'block';
                            gsap.fromTo(mainAppScreen, 
                                { opacity: 0, y: 50 }, 
                                { opacity: 1, y: 0, duration: 1, ease: 'power3.out' }
                            );
                            if (!predictionInterval) {
                                predictionInterval = setInterval(updatePrediction, 5000);
                                updatePrediction();
                            }
                            requestNotificationPermission();
                        }
                    });
                }

            } catch (error) {
                console.error("Firebase Login Error:", error);
                if (loadingDiv) loadingDiv.style.display = "none";
                if (errorDiv) errorDiv.innerText = "LOGIN FAILED: " + error.message;
                gsap.to('#error', { scale: 1, opacity: 1, duration: 0.5, ease: 'elastic.out(1, 0.6)' });
                setTimeout(() => { resetForm(); }, 2000);
            }
        };

        window.getKey = function () {
            const message = encodeURIComponent("HELLO @ORACLEXAIADMIN, I NEED AN ACCESS KEY.");
            window.open(`https://t.me/ORACLEXAIADMIN?text=${message}`, '_blank');
        };

        function populateLicenseInput() {
            const licenseInput = document.getElementById('accessKey');
            const storedKey = localStorage.getItem('last_key');
            if (licenseInput && storedKey) {
                licenseInput.value = storedKey;
            }
        }

        function createStarsLogin() {
            const container = document.getElementById('stars-container-login');
            if (!container) return;
            const starCount = 40;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                const size = Math.random() * 2 + 1;
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                const duration = Math.random() * 4 + 2 + 's';
                const delay = Math.random() * 4 + 's';
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${posX}%`;
                star.style.top = `${posY}%`;
                star.style.setProperty('--duration', duration);
                star.style.animationDelay = delay;
                
                container.appendChild(star);
            }
        }

        function createConfettiLogin() {
            const container = document.getElementById('confetti-container-login');
            if (!container) return;
            const confettiCount = 80;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                
                const size = Math.random() * 8 + 4;
                const posX = Math.random() * window.innerWidth;
                const posY = -20;
                const color = `hsl(${Math.random() * 180 + 180}, 80%, 70%)`;
                const rotation = Math.random() * 360;
                const shape = Math.random() > 0.5 ? '50%' : '0';
                
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.left = `${posX}px`;
                confetti.style.top = `${posY}px`;
                confetti.style.backgroundColor = color;
                confetti.style.borderRadius = shape;
                confetti.style.transform = `rotate(${rotation}deg)`;
                
                container.appendChild(confetti);
            }
        }

        function animateConfettiLogin() {
            const confetti = document.querySelectorAll('#confetti-container-login .confetti');
            
            confetti.forEach((piece, index) => {
                const duration = Math.random() * 2.5 + 1.5;
                const delay = index * 0.015;
                
                gsap.to(piece, {
                    y: window.innerHeight + 80,
                    x: `+=${Math.random() * 150 - 75}`,
                    rotation: Math.random() * 360,
                    opacity: 1,
                    duration: duration,
                    delay: delay,
                    ease: 'power1.out',
                    onComplete: () => {
                        piece.remove();
                    }
                });
            });
        }

        window.copyDeviceId = function () {
            const deviceId = getDeviceId();
            const tempInput = document.createElement('textarea');
            tempInput.value = deviceId;
            tempInput.style.position = 'absolute';
            tempInput.style.left = '-9999px';
            tempInput.style.top = '0';
            document.body.appendChild(tempInput);
            
            tempInput.select();
            
            let successful = false;
            try {
                successful = document.execCommand('copy');
                if (successful) {
                    const copyBtn = document.getElementById('copyDeviceIdButton');
                    const copyText = document.getElementById('copyText');
                    
                    if (copyBtn && copyText) {
                        createConfettiLogin();
                        animateConfettiLogin();
                        
                        copyBtn.classList.add('copied');
                        copyText.innerHTML = 'Copied!';
                        
                        gsap.to(copyBtn, {
                            scale: 1.08,
                            duration: 0.15,
                            yoyo: true,
                            repeat: 1,
                            ease: 'power2.inOut',
                            onComplete: () => {
                                setTimeout(() => {
                                    copyBtn.classList.remove('copied');
                                    copyText.innerHTML = 'Copy Device ID';
                                }, 1200);
                            }
                        });
                    }
                } else {
                    console.error('Failed to copy using execCommand. Fallback to manual.');
                    const messageBox = document.createElement('div');
                    messageBox.style.cssText = `
                        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                        background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
                        padding: 15px; border-radius: 5px; z-index: 1000;
                        text-align: center; font-size: 0.9em;
                    `;
                    messageBox.innerHTML = `Copy failed.<br>Please copy Device ID manually: <br><strong>${deviceId}</strong>`;
                    document.body.appendChild(messageBox);
                    setTimeout(() => messageBox.remove(), 5000);
                }
            } catch (err) {
                console.error('Error attempting to copy: ', err);
                const messageBox = document.createElement('div');
                messageBox.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
                    padding: 15px; border-radius: 5px; z-index: 1000;
                    text-align: center; font-size: 0.9em;
                `;
                messageBox.innerHTML = `Copy failed.<br>Please copy Device ID manually: <br><strong>${deviceId}</strong>`;
                document.body.appendChild(messageBox);
                setTimeout(() => messageBox.remove(), 5000);
            } finally {
                document.body.removeChild(tempInput);
            }
        };


        const loginAccessKeyInput = document.getElementById('accessKey');
        if (loginAccessKeyInput) {
            loginAccessKeyInput.addEventListener('focus', () => {
                gsap.to('.input-icon', {
                    scale: 1.1,
                    duration: 0.25,
                    ease: 'back.out'
                });
            });
            
            loginAccessKeyInput.addEventListener('blur', () => {
                gsap.to('.input-icon', {
                    scale: 1,
                    duration: 0.25,
                    ease: 'back.out'
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateLicenseInput();
            displayLastKey();
            createStarsLogin();

            gsap.to('#loginContainer', {
                opacity: 1,
                visibility: 'visible',
                y: 0,
                duration: 0.7,
                ease: 'power3.out',
                onComplete: () => {
                    const loginContainer = document.getElementById('loginContainer');
                    if (loginContainer) loginContainer.classList.add('visible');
                }
            });

            gsap.to('.logo-container', {
                scale: 1,
                opacity: 1,
                duration: 0.6,
                delay: 0.15,
                ease: 'elastic.out(1, 0.6)'
            });

            gsap.to('#inputGroup', {
                x: 0,
                opacity: 1,
                duration: 0.5,
                delay: 0.3,
                ease: 'power2.out'
            });

            const submitBtnElement = document.getElementById('submitBtn');
            if (submitBtnElement) {
                gsap.to(submitBtnElement, {
                    y: 0,
                    opacity: 1,
                    duration: 0.5,
                    delay: 0.6,
                    ease: 'power2.out'
                });
            }

            const copyDeviceIdButtonElement = document.getElementById('copyDeviceIdButton');
            if (copyDeviceIdButtonElement) { 
                gsap.to(copyDeviceIdButtonElement, {
                    y: 0,
                    opacity: 1,
                    duration: 0.5,
                    delay: 0.75,
                    ease: 'power2.out'
                });
            }

            const socialLinksElement = document.getElementById('socialLinks');
            if (socialLinksElement) { 
                gsap.to(socialLinksElement, {
                    y: 0,
                    opacity: 1,
                    duration: 0.5,
                    delay: 0.9,
                    ease: 'power2.out',
                    onComplete: () => {
                        gsap.to('.social-link', {
                            y: -8,
                            duration: 0.4,
                            stagger: 0.08,
                            repeat: -1,
                            yoyo: true,
                            ease: 'sine.inOut'
                        });
                    }
                });
            }

            gsap.to('.floating-element', {
                y: 15,
                rotation: 3,
                duration: 4,
                repeat: -1,
                yoyo: true,
                ease: 'sine.inOut',
                stagger: 0.2
            });

            if (submitBtnElement) {
                submitBtnElement.addEventListener('mouseenter', () => {
                    gsap.to(submitBtnElement, { y: -2, duration: 0.25, ease: 'power2.out' });
                });
                submitBtnElement.addEventListener('mouseleave', () => {
                    gsap.to(submitBtnElement, { y: 0, duration: 0.25, ease: 'power2.out' });
                });
            }
        });
    </script>
</body>
</html>
